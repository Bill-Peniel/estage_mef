import{_ as k,c as n,o as d,b as t,i as _,t as a,h as S,v as T,m as U,a as L,e as A,F as V,j as F,n as M,f as m,g as O,q,Y as I}from"./index-C-Ksv_Lv.js";const P={name:"Historique",setup(){const x=m(""),e=m(""),f=m([]),s=m(!1),u=m(null),c=m(null),g=async()=>{var r,l;try{s.value=!0,u.value=null;const i=await I.getHistoriqueStagiaires();console.log("Données brutes reçues:",i),f.value=i}catch(i){console.error("Erreur lors du chargement des demandes:",i),(r=i.message)!=null&&r.includes("CONNECTION_REFUSED")||(l=i.message)!=null&&l.includes("Network Error")?u.value="Impossible de se connecter au serveur. Veuillez vérifier que le serveur backend est en cours d'exécution.":u.value="Erreur lors du chargement des demandes: "+(i.message||"Erreur inconnue")}finally{s.value=!1}};O(()=>{g()});const p=q(()=>{let r=f.value;return x.value&&(r=r.filter(l=>{var E,h;const i=l.stagiaire.profile.nom||"",C=l.stagiaire.profile.prenom||"",N=l.stagiaire.email||"",R=((h=(E=l.stagiaire.stagiaire)==null?void 0:E.structure)==null?void 0:h.nomStructure)||"",y=x.value.toLowerCase();return i.toLowerCase().includes(y)||C.toLowerCase().includes(y)||N.toLowerCase().includes(y)||R.toLowerCase().includes(y)})),e.value&&(r=r.filter(l=>l.status===e.value)),r});return{searchQuery:x,filterStatus:e,filteredDemandes:p,formatDate:r=>new Date(r).toLocaleDateString("fr-FR"),getStatusClass:r=>({APPROUVE:"bg-green-100 text-green-800",REFUSE:"bg-red-100 text-red-800",EN_COURS:"bg-blue-100 text-blue-800",TERMINE:"bg-gray-100 text-gray-800"})[r]||"bg-gray-100 text-gray-800",getStatusLabel:r=>({APPROUVE:"Approuvé",REFUSE:"Refusé",EN_COURS:"En cours",TERMINE:"Terminé"})[r]||r,viewDetails:r=>{c.value=r},closeDetails:()=>{c.value=null},selectedDemande:c,loading:s,error:u}}},j={class:"p-4"},B={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},H={key:1,class:"flex justify-center items-center py-4"},Q={key:2,class:"bg-white rounded-lg shadow"},z={class:"p-4 border-b"},Y={class:"flex justify-between items-center"},G={class:"flex items-center space-x-4"},J={class:"overflow-x-auto"},K={class:"min-w-full divide-y divide-gray-200"},W={class:"bg-white divide-y divide-gray-200"},X={key:0,class:"hover:bg-gray-50"},Z={class:"px-6 py-4"},$={class:"text-sm font-medium text-gray-900"},tt={class:"text-sm text-gray-500"},et={class:"px-6 py-4 text-sm text-gray-500"},st={class:"px-6 py-4 text-sm text-gray-500"},at={class:"px-6 py-4 text-sm text-gray-500"},rt={class:"px-6 py-4"},ot={class:"px-6 py-4 text-sm font-medium"},lt=["onClick"],it={key:3,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4"},nt={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full"},dt={class:"p-6"},mt={class:"flex justify-between items-start"},ut={class:"mt-4 space-y-4"},xt={class:"mt-2 grid grid-cols-2 gap-4"},ct={class:"mt-1 text-sm text-gray-500"},gt={class:"mt-1 text-sm text-gray-500"},pt={class:"mt-1 text-sm text-gray-500"},yt={class:"mt-1 text-sm text-gray-500"},ft={class:"mt-1 text-sm text-gray-500"},vt={class:"mt-1 text-sm text-gray-500"},bt={class:"mt-2 grid grid-cols-2 gap-4"},Dt={class:"mt-1 text-sm text-gray-500"},wt={class:"mt-1 text-sm text-gray-500"},_t={class:"mt-1 text-sm text-gray-500"},Et={class:"mt-1 text-sm text-gray-500"},ht={class:"mt-2 grid grid-cols-2 gap-4"},St={class:"mt-1 text-sm text-gray-500"},Ct={class:"mt-1 text-sm text-gray-500"},Nt={class:"mt-2 space-y-4"},Rt={class:"mt-1 text-sm text-gray-500 whitespace-pre-wrap"},kt={class:"mt-1 text-sm text-gray-500 whitespace-pre-wrap"},Tt={class:"mt-1 text-sm text-gray-500 whitespace-pre-wrap"};function Ut(x,e,f,s,u,c){var g,p,v,b,D;return d(),n("div",j,[e[30]||(e[30]=t("h1",{class:"text-2xl text-slate-800 font-bold mb-6"},"Historique des demandes",-1)),s.error?(d(),n("div",B,a(s.error),1)):_("",!0),s.loading?(d(),n("div",H,e[3]||(e[3]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):(d(),n("div",Q,[t("div",z,[t("div",Y,[t("div",G,[S(t("input",{type:"text",placeholder:"Rechercher une demande...",class:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":e[0]||(e[0]=o=>s.searchQuery=o)},null,512),[[T,s.searchQuery]]),S(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.filterStatus=o),class:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"},e[4]||(e[4]=[L('<option value="">Tous les statuts</option><option value="APPROUVE">Approuvé</option><option value="REFUSE">Refusé</option><option value="EN_COURS">En cours</option><option value="TERMINE">Terminé</option>',5)]),512),[[U,s.filterStatus]])]),e[5]||(e[5]=t("button",{class:"bg-[#E1AD01] text-white px-4 py-2 rounded-lg hover:bg-[#F5BC00]"},[t("i",{class:"fas fa-download mr-2"}),A("Exporter ")],-1))])]),t("div",J,[t("table",K,[e[8]||(e[8]=t("thead",{class:"bg-slate-500"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-white text-xs font-medium text-gray-500 uppercase"},"Stagiaire"),t("th",{class:"px-6 py-3 text-left bg-slate-700 text-white text-xs font-medium text-gray-500 uppercase"},"Structure"),t("th",{class:"px-6 py-3 text-left text-white text-xs font-medium text-gray-500 uppercase"},"Type de Stage"),t("th",{class:"px-6 py-3 text-left bg-slate-700 text-white text-xs font-medium text-gray-500 uppercase"},"Date"),t("th",{class:"px-6 py-3 text-left text-white text-xs font-medium text-gray-500 uppercase"},"Statut"),t("th",{class:"px-6 py-3 text-left bg-slate-700 text-white text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),t("tbody",W,[s.filteredDemandes.length===0?(d(),n("tr",X,e[6]||(e[6]=[t("td",{colspan:"6",class:"px-6 py-4 text-center text-sm text-gray-500"}," Aucune demande approuvée ou refusée trouvée ",-1)]))):_("",!0),(d(!0),n(V,null,F(s.filteredDemandes,o=>{var w,r;return d(),n("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",Z,[t("div",$,a(o.stagiaire.profile.nom)+" "+a(o.stagiaire.profile.prenom),1),t("div",tt,a(o.stagiaire.email),1)]),t("td",et,a(((r=(w=o.stagiaire.stagiaire)==null?void 0:w.structure)==null?void 0:r.nomStructure)||"Non assigné"),1),t("td",st,a(o.type),1),t("td",at,a(s.formatDate(o.createdAt)),1),t("td",rt,[t("span",{class:M(["px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full",s.getStatusClass(o.status)])},a(s.getStatusLabel(o.status)),3)]),t("td",ot,[t("button",{onClick:l=>s.viewDetails(o),class:"text-primary hover:text-primary-dark"},e[7]||(e[7]=[t("i",{class:"fas fa-eye"},null,-1)]),8,lt)])])}),128))])])])])),s.selectedDemande?(d(),n("div",it,[t("div",nt,[t("div",dt,[t("div",mt,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-gray-900"},"Détails de la demande",-1)),t("button",{onClick:e[2]||(e[2]=(...o)=>s.closeDetails&&s.closeDetails(...o)),class:"text-gray-400 hover:text-gray-500"},e[9]||(e[9]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",ut,[t("div",null,[e[17]||(e[17]=t("h4",{class:"text-sm font-medium text-gray-500"},"Informations personnelles",-1)),t("div",xt,[t("div",null,[e[11]||(e[11]=t("p",{class:"text-sm text-gray-900"},"Nom complet",-1)),t("p",ct,a(s.selectedDemande.stagiaire.profile.nom)+" "+a(s.selectedDemande.stagiaire.profile.prenom),1)]),t("div",null,[e[12]||(e[12]=t("p",{class:"text-sm text-gray-900"},"Email",-1)),t("p",gt,a(s.selectedDemande.stagiaire.email),1)]),t("div",null,[e[13]||(e[13]=t("p",{class:"text-sm text-gray-900"},"Téléphone",-1)),t("p",pt,a(s.selectedDemande.stagiaire.profile.telephone||"Non renseigné"),1)]),t("div",null,[e[14]||(e[14]=t("p",{class:"text-sm text-gray-900"},"Université",-1)),t("p",yt,a(s.selectedDemande.universite),1)]),t("div",null,[e[15]||(e[15]=t("p",{class:"text-sm text-gray-900"},"Domaine d'études",-1)),t("p",ft,a(s.selectedDemande.domaineEtude),1)]),t("div",null,[e[16]||(e[16]=t("p",{class:"text-sm text-gray-900"},"Année d'études",-1)),t("p",vt,a(s.selectedDemande.anneeEtude),1)])])]),t("div",null,[e[22]||(e[22]=t("h4",{class:"text-sm font-medium text-gray-500"},"Informations du stage",-1)),t("div",bt,[t("div",null,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-900"},"Structure",-1)),t("p",Dt,a(((p=(g=s.selectedDemande.stagiaire.stagiaire)==null?void 0:g.structure)==null?void 0:p.nomStructure)||"Non assigné"),1)]),t("div",null,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-900"},"Tuteur",-1)),t("p",wt,a((D=(b=(v=s.selectedDemande.stagiaire.stagiaire)==null?void 0:v.tuteur)==null?void 0:b.user)!=null&&D.profile?`${s.selectedDemande.stagiaire.stagiaire.tuteur.user.profile.nom} ${s.selectedDemande.stagiaire.stagiaire.tuteur.user.profile.prenom}`:"Non assigné"),1)]),t("div",null,[e[20]||(e[20]=t("p",{class:"text-sm text-gray-900"},"Département",-1)),t("p",_t,a(s.selectedDemande.departement),1)]),t("div",null,[e[21]||(e[21]=t("p",{class:"text-sm text-gray-900"},"Type de stage",-1)),t("p",Et,a(s.selectedDemande.type),1)])])]),t("div",null,[e[25]||(e[25]=t("h4",{class:"text-sm font-medium text-gray-500"},"Dates",-1)),t("div",ht,[t("div",null,[e[23]||(e[23]=t("p",{class:"text-sm text-gray-900"},"Date de début",-1)),t("p",St,a(s.formatDate(s.selectedDemande.dateDebut)),1)]),t("div",null,[e[24]||(e[24]=t("p",{class:"text-sm text-gray-900"},"Date de fin",-1)),t("p",Ct,a(s.formatDate(s.selectedDemande.dateFin)),1)])])]),t("div",null,[e[29]||(e[29]=t("h4",{class:"text-sm font-medium text-gray-500"},"Motivation et compétences",-1)),t("div",Nt,[t("div",null,[e[26]||(e[26]=t("p",{class:"text-sm text-gray-900"},"Motivation",-1)),t("p",Rt,a(s.selectedDemande.motivation),1)]),t("div",null,[e[27]||(e[27]=t("p",{class:"text-sm text-gray-900"},"Compétences",-1)),t("p",kt,a(s.selectedDemande.competences),1)]),t("div",null,[e[28]||(e[28]=t("p",{class:"text-sm text-gray-900"},"Expérience",-1)),t("p",Tt,a(s.selectedDemande.experience),1)])])])])])])])):_("",!0)])}const At=k(P,[["render",Ut]]);export{At as default};
