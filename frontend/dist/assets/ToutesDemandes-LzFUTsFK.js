import{_ as B,r as V,c as u,o as c,b as e,i as T,W as z,t as i,h as Q,v as W,e as x,F as A,j as I,n as Y,f as m,I as G,g as H,q as v,Y as D}from"./index-C-Ksv_Lv.js";import{D as J}from"./DemandeDetails-DFwU9D79.js";const K={name:"ToutesDemandes",components:{DemandeDetails:J},setup(){const P=m(""),r=m(null),y=m([]),s=m(!1),g=m(null),p=m(1),f=15,a=G(),w=m(!1),k=m(""),C=async()=>{try{s.value=!0,g.value=null;const o=await D.getStageRequestsForDPAF();console.log("Réponse brute de l'API:",o),y.value=o.filter(t=>t.status==="EN_ATTENTE").map(t=>{var n,l,d,h,S,q,M;return console.log("Documents de la demande:",{cv:t.cv,lettreMotivation:t.lettreMotivation,carteIdentite:t.carteIdentite,inscriptionUniversitaire:t.inscriptionUniversitaire,recommandation:t.recommandation,autresDocuments:t.autresDocuments}),{id:t.id,nom:`${((l=(n=t.stagiaire)==null?void 0:n.profile)==null?void 0:l.prenom)||""} ${((h=(d=t.stagiaire)==null?void 0:d.profile)==null?void 0:h.nom)||""}`.trim(),email:((S=t.stagiaire)==null?void 0:S.email)||"",telephone:((M=(q=t.stagiaire)==null?void 0:q.profile)==null?void 0:M.telephone)||"",typeStage:t.type||"",departement:t.departement||"",universite:t.universite||"",domaineEtude:t.domaineEtude||"",dateSoumission:t.createdAt,dateDebut:t.dateDebut,dateFin:t.dateFin,status:t.status||"EN_ATTENTE",code_suivi:t.code_suivi||"",cv:t.cv,lettreMotivation:t.lettreMotivation,carteIdentite:t.carteIdentite,inscriptionUniversitaire:t.inscriptionUniversitaire,recommandation:t.recommandation,autresDocuments:t.autresDocuments||[]}}),console.log("Demandes transformées:",y.value)}catch(o){console.error("Erreur lors du chargement des demandes:",o),g.value="Erreur lors du chargement des demandes"}finally{s.value=!1}};H(()=>{C()});const _=v(()=>{const o=P.value.toLowerCase();return y.value.filter(t=>{var n,l,d,h;return(((n=t.nom)==null?void 0:n.toLowerCase())||"").includes(o)||(((l=t.email)==null?void 0:l.toLowerCase())||"").includes(o)||(((d=t.departement)==null?void 0:d.toLowerCase())||"").includes(o)||(((h=t.universite)==null?void 0:h.toLowerCase())||"").includes(o)})}),b=v(()=>Math.ceil(_.value.length/f)),j=v(()=>(p.value-1)*f),R=v(()=>Math.min(j.value+f,_.value.length)),F=v(()=>_.value.slice(j.value,R.value)),L=v(()=>{const o=[];if(b.value<=5)for(let n=1;n<=b.value;n++)o.push(n);else{let n=Math.max(1,p.value-Math.floor(2.5)),l=n+5-1;l>b.value&&(l=b.value,n=Math.max(1,l-5+1));for(let d=n;d<=l;d++)o.push(d)}return o}),N=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}),U=o=>{r.value=o},E=()=>{r.value=null};return{searchQuery:P,filteredDemandes:_,paginatedDemandes:F,currentPage:p,totalPages:b,startIndex:j,endIndex:R,displayedPages:L,formatDate:N,viewDetails:U,approveRequest:async o=>{try{s.value=!0,await D.approveStageRequest(o.id),a.success("Demande approuvée avec succès"),await C(),p.value=1,E()}catch(t){console.error("Erreur lors de l'approbation:",t),a.error(t.message||"Erreur lors de l'approbation de la demande")}finally{s.value=!1}},rejectRequest:async o=>{try{s.value=!0,await D.rejectStageRequest(o.id,k.value),a.success("Demande rejetée avec succès"),await C(),p.value=1,E(),w.value=!1,k.value=""}catch(t){console.error("Erreur lors du rejet:",t),a.error(t.message||"Erreur lors du rejet de la demande")}finally{s.value=!1}},selectedDemande:r,closeDetails:E,loading:s,error:g,showRejectModal:w,rejectReason:k,fetchDemandes:async()=>{try{s.value=!0,g.value=null;const o=await D.getStageRequestsForDPAF();y.value=o}catch(o){console.error("Erreur lors du chargement des demandes:",o),g.value="Erreur lors du chargement des demandes"}finally{s.value=!1}}}}},O={class:"p-4"},X={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},Z={key:1,class:"flex justify-center items-center py-4"},$={key:2,class:"bg-white rounded-lg shadow"},ee={class:"p-4 border-b"},te={class:"flex justify-between items-center"},se={class:"flex items-center space-x-4"},re={class:"overflow-x-auto"},ae={class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-white divide-y divide-gray-200"},ne={class:"px-6 py-4 whitespace-nowrap"},ie={class:"text-sm font-medium text-gray-900"},le={class:"text-sm text-gray-500"},de={class:"text-xs text-gray-400"},ce={class:"px-6 py-4 whitespace-nowrap bg-gray-200 text-sm text-gray-700"},ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},me={class:"px-6 py-4 whitespace-nowrap bg-gray-200 text-sm text-gray-700"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},pe={class:"px-6 py-4 whitespace-nowrap bg-gray-200 text-sm font-medium space-x-2"},xe=["onClick"],ve={class:"px-4 py-3 border-t border-gray-200 sm:px-6"},ye={class:"flex items-center justify-between"},fe={class:"flex-1 flex justify-between sm:hidden"},be=["disabled"],he=["disabled"],we={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},_e={class:"text-sm text-gray-700"},De={class:"font-medium"},Pe={class:"font-medium"},ke={class:"font-medium"},Ce={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},je=["disabled"],Ee=["onClick"],Re=["disabled"];function Se(P,r,y,s,g,p){const f=V("DemandeDetails");return c(),u("div",O,[r[16]||(r[16]=e("h1",{class:"text-2xl text-slate-800 font-bold mb-6 flex justify-center items-center"},"Demandes en attente",-1)),s.error?(c(),u("div",X,i(s.error),1)):T("",!0),s.loading?(c(),u("div",Z,r[5]||(r[5]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):(c(),u("div",$,[e("div",ee,[e("div",te,[e("div",se,[r[6]||(r[6]=e("i",{class:"fas fa-search border-2 text-slate-800 border-gray-300 rounded-lg p-2"},null,-1)),Q(e("input",{type:"text",placeholder:"Rechercher une demande...",class:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":r[0]||(r[0]=a=>s.searchQuery=a)},null,512),[[W,s.searchQuery]])]),r[7]||(r[7]=e("button",{class:"bg-[#E1AD01] text-white px-4 py-2 rounded-lg hover:bg-[#F5BC00]"},[e("i",{class:"fas fa-download mr-2"}),x("Exporter ")],-1))])]),e("div",re,[e("table",ae,[r[9]||(r[9]=e("thead",{class:"bg-gray-50 bg-slate-500"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-white text-xs font-medium uppercase tracking-wider"},"Stagiaire"),e("th",{class:"px-6 bg-slate-700 py-3 text-left text-white text-xs font-medium uppercase tracking-wider"},"Département"),e("th",{class:"px-6 py-3 text-left text-white text-xs font-medium uppercase tracking-wider"},"Université"),e("th",{class:"px-6 bg-slate-700 py-3 text-left text-white text-xs font-medium uppercase tracking-wider"},"Type"),e("th",{class:"px-6 py-3 text-left text-white text-xs font-medium uppercase tracking-wider"},"Date"),e("th",{class:"px-6 bg-slate-700 py-3 text-left text-white text-xs font-medium uppercase tracking-wider"},"Actions")])],-1)),e("tbody",oe,[(c(!0),u(A,null,I(s.paginatedDemandes,a=>(c(),u("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",ne,[e("div",ie,i(a.nom),1),e("div",le,i(a.email),1),e("div",de,"Code: "+i(a.code_suivi),1)]),e("td",ce,i(a.departement),1),e("td",ue,i(a.universite),1),e("td",me,i(a.typeStage),1),e("td",ge,i(s.formatDate(a.dateSoumission)),1),e("td",pe,[e("button",{onClick:w=>s.viewDetails(a),class:"text-blue-600 hover:text-yellow-dark flex justify-between items-center gap-2"},r[8]||(r[8]=[x(" Voir "),e("i",{class:"fas fa-eye"},null,-1)]),8,xe)])]))),128))])])]),e("div",ve,[e("div",ye,[e("div",fe,[e("button",{onClick:r[1]||(r[1]=a=>s.currentPage--),disabled:s.currentPage===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Précédent ",8,be),e("button",{onClick:r[2]||(r[2]=a=>s.currentPage++),disabled:s.currentPage>=s.totalPages,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Suivant ",8,he)]),e("div",we,[e("div",null,[e("p",_e,[r[10]||(r[10]=x(" Affichage de ")),e("span",De,i(s.startIndex+1),1),r[11]||(r[11]=x(" à ")),e("span",Pe,i(s.endIndex),1),r[12]||(r[12]=x(" sur ")),e("span",ke,i(s.filteredDemandes.length),1),r[13]||(r[13]=x(" résultats "))])]),e("div",null,[e("nav",Ce,[e("button",{onClick:r[3]||(r[3]=a=>s.currentPage--),disabled:s.currentPage===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},r[14]||(r[14]=[e("span",{class:"sr-only"},"Précédent",-1),e("i",{class:"fas fa-chevron-left"},null,-1)]),8,je),(c(!0),u(A,null,I(s.displayedPages,a=>(c(),u("button",{key:a,onClick:w=>s.currentPage=a,class:Y([s.currentPage===a?"z-10 bg-slate-50 border-slate-500 text-slate-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},i(a),11,Ee))),128)),e("button",{onClick:r[4]||(r[4]=a=>s.currentPage++),disabled:s.currentPage>=s.totalPages,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},r[15]||(r[15]=[e("span",{class:"sr-only"},"Suivant",-1),e("i",{class:"fas fa-chevron-right"},null,-1)]),8,Re)])])])])])])),s.selectedDemande?(c(),z(f,{key:3,demande:s.selectedDemande,onClose:s.closeDetails,onApprove:s.approveRequest,onReject:s.rejectRequest},null,8,["demande","onClose","onApprove","onReject"])):T("",!0)])}const Fe=B(K,[["render",Se],["__scopeId","data-v-55ec525d"]]);export{Fe as default};
