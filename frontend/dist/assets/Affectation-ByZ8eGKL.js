import{_ as B,c as o,o as c,b as r,d as M,e as b,t as i,w as j,i as k,n as T,T as q,F as w,j as S,h as D,m as E,u as F,f as d,q as v,g as L,s as U,L as J}from"./index-C-Ksv_Lv.js";const O={name:"AffectationTuteur",setup(){const p=F(),s=d([]),u=d([]),t=d({}),f=d({}),m=d({message:"",success:!0});d(null);let a=null;const n=async()=>{const e=await p.dispatch("tutor/getAssignedInterns");s.value=e||[]},A=async()=>{try{const e=await U.getTuteurs();u.value=e.data||e}catch{u.value=[]}},y=()=>{const e=localStorage.getItem("user");if(!e)return null;try{return JSON.parse(e)}catch{return null}},N=v(()=>{var e;return(e=y())==null?void 0:e.id}),V=v(()=>{var e;return((e=y())==null?void 0:e.name)||"Inconnu"}),C=v(()=>u.value.filter(e=>e.id!==N.value)),x=(e,l=!0)=>{m.value={message:e,success:l},a&&clearTimeout(a),a=setTimeout(()=>{m.value.message=""},3500)},h=async e=>{const l=t.value[e];if(l){f.value[e]=!0;try{await J.assignStagiaireToTuteur(e,l),x("Stagiaire réaffecté avec succès !",!0),await n(),t.value[e]=""}catch(g){x(g.message||"Erreur lors de la réaffectation",!1)}f.value[e]=!1}},I=e=>{var _;const l=t.value[e],g=((_=u.value.find(z=>z.id===l))==null?void 0:_.nom)||"ce tuteur";l&&window.confirm(`Voulez-vous vraiment réaffecter ce stagiaire à ${g} ?`)&&h(e)};return L(()=>{n(),A()}),{assignedInterns:s,tuteurs:u,selectedTuteur:t,assignToTuteur:h,confirmAssign:I,feedback:m,filteredTuteurs:C,loading:f,currentTuteurName:V}}},R={class:"p-8 min-h-screen affectation-bg"},G={class:"bg-white p-4 rounded-lg shadow-md"},H={class:"mb-2 text-gray-700 flex items-center"},K={class:"font-semibold text-primary ml-1"},P={key:0},Q={class:"font-medium text-gray-900 group-hover:text-primary transition"},W={class:"text-gray-500"},X={class:"ml-2 text-xs text-gray-500"},Y={class:"flex items-center gap-2"},Z=["onUpdate:modelValue"],$=["value"],ee=["onClick","disabled"],te={key:0,class:"loader mr-2"},se={key:1,class:"text-gray-400"};function re(p,s,u,t,f,m){return c(),o("div",R,[r("div",G,[s[5]||(s[5]=r("h1",{class:"text-2xl font-bold mb-2"},"Affectation de mes stagiaires",-1)),r("p",H,[s[0]||(s[0]=r("i",{class:"fas fa-user-circle text-primary text-xl mr-2"},null,-1)),s[1]||(s[1]=b(" Connecté en tant que ")),r("span",K,i(t.currentTuteurName),1)]),s[6]||(s[6]=r("p",{class:"mb-6 text-gray-700"},"Vous pouvez réaffecter vos stagiaires à un autre membre de la structure.",-1)),M(q,{name:"snackbar-fade"},{default:j(()=>[t.feedback.message?(c(),o("div",{key:0,class:T(["snackbar",t.feedback.success?"snackbar-success":"snackbar-error"])},[r("i",{class:T([t.feedback.success?"fas fa-check-circle":"fas fa-exclamation-triangle","mr-2"])},null,2),b(" "+i(t.feedback.message),1)],2)):k("",!0)]),_:1}),r("div",null,[s[4]||(s[4]=r("h2",{class:"text-lg font-semibold mb-2"},"Mes stagiaires",-1)),t.assignedInterns.length?(c(),o("ul",P,[(c(!0),o(w,null,S(t.assignedInterns,a=>(c(),o("li",{key:a.id,class:"py-2 border-b flex flex-col md:flex-row md:items-center md:justify-between gap-2 bg-white bg-opacity-80 rounded-lg transition hover:shadow-lg hover:bg-blue-50/80 group"},[r("div",null,[r("span",Q,i(a.name),1),r("span",W," ("+i(a.email)+")",1),r("span",X,i(a.status),1)]),r("div",Y,[D(r("select",{"onUpdate:modelValue":n=>t.selectedTuteur[a.id]=n,class:"border border-primary rounded px-2 py-1 focus:ring-2 focus:ring-primary focus:border-primary transition"},[s[2]||(s[2]=r("option",{disabled:"",value:""},"Affecter à...",-1)),(c(!0),o(w,null,S(t.filteredTuteurs,n=>(c(),o("option",{key:n.id,value:n.id},i(n.nom),9,$))),128))],8,Z),[[E,t.selectedTuteur[a.id]]]),r("button",{onClick:n=>t.confirmAssign(a.id),disabled:!t.selectedTuteur[a.id]||t.loading[a.id],class:"px-3 py-1 bg-primary text-white rounded shadow hover:bg-primary-dark disabled:opacity-50 flex items-center transition"},[t.loading[a.id]?(c(),o("span",te)):k("",!0),s[3]||(s[3]=b(" Réaffecter "))],8,ee)])]))),128))])):(c(),o("p",se,"Aucun stagiaire affecté pour le moment."))])])])}const ne=B(O,[["render",re],["__scopeId","data-v-ccf40001"]]);export{ne as default};
