import{_ as h,c as o,o as l,b as t,i as c,l as f,h as y,m as g,F as m,j as p,t as a,e as b,C as u}from"./index-C-Ksv_Lv.js";const x={name:"Documents",data(){return{loading:!0,uploading:!1,error:"",success:"",documents:[],newDoc:{type:"",file:null},documentTypes:[{key:"cv",label:"CV"},{key:"lettre_motivation",label:"Lettre de motivation"},{key:"carte_identite",label:"Carte d'identité"},{key:"inscription_universitaire",label:"Inscription universitaire"},{key:"recommandation",label:"Lettre de recommandation"},{key:"autre",label:"Autre"}]}},methods:{async fetchDocuments(){this.loading=!0,this.error="";try{const s=localStorage.getItem("token"),e=await u.get("/api/documents",{headers:{Authorization:`Bearer ${s}`}});this.documents=e.data}catch{this.error="Erreur lors du chargement des documents."}finally{this.loading=!1}},onFileChange(s){this.newDoc.file=s.target.files[0],this.success="",this.error=""},async uploadDocument(){if(!this.newDoc.type||!this.newDoc.file){this.error="Veuillez choisir un type et un fichier.";return}this.uploading=!0,this.error="",this.success="";try{const s=new FormData;s.append("type",this.newDoc.type),s.append("file",this.newDoc.file);const e=localStorage.getItem("token");await u.post("/api/documents",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),this.success="Document téléversé avec succès !",this.newDoc={type:"",file:null},this.$refs.fileInput&&(this.$refs.fileInput.value=""),await this.fetchDocuments()}catch{this.error="Erreur lors du téléversement."}finally{this.uploading=!1}},async deleteDocument(s){if(confirm("Supprimer ce document ?")){this.error="",this.success="";try{const e=localStorage.getItem("token");await u.delete(`/api/documents/${s}`,{headers:{Authorization:`Bearer ${e}`}}),this.success="Document supprimé.",await this.fetchDocuments()}catch{this.error="Erreur lors de la suppression."}}},getDocumentUrl(s){return s?`/api/uploads/${s}`:"#"},getTypeLabel(s){const e=this.documentTypes.find(d=>d.key===s);return e?e.label:s},formatDate(s){return new Date(s).toLocaleDateString()}},async mounted(){await this.fetchDocuments()}},v={class:"p-6 px-60"},D={class:"bg-white rounded-lg shadow"},w={class:"p-6"},k=["value"],_={key:0,class:"text-xs text-gray-600 mt-1"},C=["disabled"],T={key:0},S={key:0,class:"text-center text-gray-500 mb-2"},F={key:1,class:"text-center text-red-500 mb-2 bg-red-50 border border-red-200 rounded p-2"},A={key:2,class:"text-center text-green-600 mb-2 bg-green-50 border border-green-200 rounded p-2"},B={key:3,class:"text-center py-10"},I={key:4,class:"text-center py-10 text-gray-500"},L={key:5,class:"w-full text-left border text-sm md:text-base"},V={class:"p-2"},z={class:"p-2 break-all max-w-xs"},M={class:"p-2"},E={class:"p-2 flex gap-2 items-center flex-wrap"},N=["href"],U=["onClick"];function j(s,e,d,q,r,i){return l(),o("div",v,[e[10]||(e[10]=t("h1",{class:"text-2xl font-semibold mb-6"},"Mes Documents personnels",-1)),t("div",D,[t("div",w,[t("form",{onSubmit:e[2]||(e[2]=f((...n)=>i.uploadDocument&&i.uploadDocument(...n),["prevent"])),class:"mb-8 flex flex-col md:flex-row md:items-end gap-4"},[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium mb-1"},"Type de document",-1)),y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>r.newDoc.type=n),class:"border rounded px-2 py-1"},[e[3]||(e[3]=t("option",{disabled:"",value:""},"Choisir un type",-1)),(l(!0),o(m,null,p(r.documentTypes,n=>(l(),o("option",{key:n.key,value:n.key},a(n.label),9,k))),128))],512),[[g,r.newDoc.type]])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium mb-1"},"Fichier",-1)),t("input",{type:"file",ref:"fileInput",onChange:e[1]||(e[1]=(...n)=>i.onFileChange&&i.onFileChange(...n))},null,544),r.newDoc.file?(l(),o("div",_,"Fichier sélectionné : "+a(r.newDoc.file.name),1)):c("",!0)]),t("button",{class:"btn-primary h-10 px-6 flex items-center justify-center gap-2",disabled:r.uploading||!r.newDoc.type||!r.newDoc.file},[r.uploading?(l(),o("span",T,e[6]||(e[6]=[t("svg",{class:"animate-spin h-5 w-5 text-white inline-block",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})],-1)]))):c("",!0),t("span",null,a(r.uploading?"Téléversement...":"Téléverser"),1)],8,C)],32),r.uploading?(l(),o("div",S,"Téléversement en cours...")):c("",!0),r.error?(l(),o("div",F,a(r.error),1)):c("",!0),r.success?(l(),o("div",A,a(r.success),1)):c("",!0),e[9]||(e[9]=t("h3",{class:"text-lg font-medium mb-4"},"Mes documents sauvegardés",-1)),r.loading?(l(),o("div",B,"Chargement...")):r.documents.length===0?(l(),o("div",I,"Aucun document sauvegardé.")):(l(),o("table",L,[e[8]||(e[8]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-2"},"Type"),t("th",{class:"p-2"},"Nom"),t("th",{class:"p-2"},"Date"),t("th",{class:"p-2"},"Actions")])],-1)),t("tbody",null,[(l(!0),o(m,null,p(r.documents,n=>(l(),o("tr",{key:n.id,class:"border-t hover:bg-gray-50 transition"},[t("td",V,a(i.getTypeLabel(n.type)),1),t("td",z,a(n.name),1),t("td",M,a(i.formatDate(n.uploadedAt)),1),t("td",E,[t("a",{href:i.getDocumentUrl(n.path),target:"_blank",class:"text-blue-600 underline"},"Télécharger",8,N),t("button",{class:"text-red-500 hover:underline",onClick:G=>i.deleteDocument(n.id)},e[7]||(e[7]=[t("i",{class:"fas fa-trash"},null,-1),b(" Supprimer")]),8,U)])]))),128))])]))])])])}const J=h(x,[["render",j]]);export{J as default};
