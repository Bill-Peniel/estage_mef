import{_ as B,c as m,o as c,b as t,i as F,e as z,F as C,j as M,t as f,n as I,l as L,h as g,v as S,x as G,m as D,f as r,q as J,g as R,J as y,C as H}from"./index-C-Ksv_Lv.js";const K={name:"Themes",setup(){const h=r(!1),e=r(!1),T=r([]),l=r([]),v=r({titre:"",description:"",disponible:!0}),w=r(""),s=r(""),p=r(""),k=r(""),n=r(!1),b=r(""),d=r(""),A=J(()=>T.value.filter(i=>{const o=!w.value||(w.value==="disponible"?i.disponible:!i.disponible),a=!s.value||i.titre.toLowerCase().includes(s.value.toLowerCase());return o&&a})),x=async()=>{try{n.value=!0,T.value=await y.getThemes()}catch{d.value="Erreur lors du chargement des thèmes."}finally{n.value=!1}},j=async()=>{try{n.value=!0;const i=localStorage.getItem("token"),o=await H.get("http://localhost:3002/api/affectations/tuteur/stagiaires",{headers:{Authorization:`Bearer ${i}`}});l.value=o.data.map(a=>{var u;return{id:a.userId,nom:(u=a.user)!=null&&u.profile?`${a.user.profile.prenom} ${a.user.profile.nom}`:a.userId}})}catch{d.value="Erreur lors du chargement des stagiaires."}finally{n.value=!1}};R(()=>{x(),j()});const V=async()=>{var i,o;if(!(!p.value||!k.value))try{n.value=!0,await y.affecterTheme(k.value,p.value),b.value="Thème affecté avec succès !",d.value="",await x(),p.value="",k.value=""}catch(a){d.value=((o=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:o.message)||"Erreur lors de l'affectation.",b.value=""}finally{n.value=!1}},_=async()=>{var i,o;try{n.value=!0,e.value?await y.updateTheme(v.value.id,v.value):await y.createTheme(v.value),await x(),h.value=!1,q(),b.value=e.value?"Thème modifié !":"Thème ajouté !",d.value=""}catch(a){d.value=((o=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:o.message)||"Erreur lors de l'enregistrement.",b.value=""}finally{n.value=!1}},E=i=>{e.value=!0,v.value={...i},h.value=!0},U=async i=>{var o,a;if(confirm("Êtes-vous sûr de vouloir supprimer ce thème ?"))try{n.value=!0,await y.deleteTheme(i),await x(),b.value="Thème supprimé !",d.value=""}catch(u){d.value=((a=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:a.message)||"Erreur lors de la suppression.",b.value=""}finally{n.value=!1}},N=async i=>{var o,a;try{n.value=!0,await y.updateTheme(i.id,{...i,disponible:!i.disponible}),await x()}catch(u){d.value=((a=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:a.message)||"Erreur lors du changement de disponibilité."}finally{n.value=!1}},q=()=>{e.value=!1,v.value={titre:"",description:"",disponible:!0}};return{showAddModal:h,editMode:e,themes:T,formData:v,saveTheme:_,editTheme:E,deleteTheme:U,toggleDisponibilite:N,stagiaires:l,filtreStatut:w,searchTheme:s,selectedStagiaire:p,selectedTheme:k,filteredThemes:A,affecterTheme:V,loading:n,successMessage:b,errorMessage:d}}},O={class:"p-6"},P={class:"mb-6 flex justify-between items-center"},Q={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},W={class:"flex justify-between items-start mb-4"},X={class:"font-semibold text-lg text-gray-800"},Y={class:"flex space-x-2"},Z=["onClick"],$=["onClick"],ee={class:"text-gray-600 mb-4"},te={class:"flex justify-between items-center"},se=["onClick"],le={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ie={class:"bg-white rounded-lg w-full max-w-md"},ae={class:"px-6 py-4 border-b border-gray-200"},oe={class:"text-lg font-semibold"},ne={class:"space-y-4"},re={class:"flex items-center"},de={class:"mt-6 flex justify-end space-x-3"},ue={type:"submit",class:"btn-primary"},me={class:"mt-8 bg-white rounded-lg shadow-sm p-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"space-y-4"},ve={class:"space-y-4"},pe=["value"],be=["value","disabled"],ge=["disabled"];function ye(h,e,T,l,v,w){return c(),m(C,null,[t("div",O,[t("div",P,[e[12]||(e[12]=t("h1",{class:"text-2xl font-bold text-gray-800"},"Gestion des Thèmes",-1)),t("button",{onClick:e[0]||(e[0]=s=>l.showAddModal=!0),class:"btn-primary"},e[11]||(e[11]=[t("i",{class:"fas fa-plus mr-2"},null,-1),z(" Ajouter un thème ")]))]),t("div",Q,[(c(!0),m(C,null,M(l.themes,s=>(c(),m("div",{key:s.id,class:"bg-white rounded-lg shadow-sm p-6"},[t("div",W,[t("h3",X,f(s.titre),1),t("div",Y,[t("button",{onClick:p=>l.editTheme(s),class:"text-primary hover:text-primary-dark"},e[13]||(e[13]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Z),t("button",{onClick:p=>l.deleteTheme(s.id),class:"text-red-600 hover:text-red-800"},e[14]||(e[14]=[t("i",{class:"fas fa-trash"},null,-1)]),8,$)])]),t("p",ee,f(s.description),1),t("div",te,[t("span",{class:I(["px-2 py-1 rounded-full text-sm",s.disponible?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},f(s.disponible?"Disponible":"Non disponible"),3),t("button",{onClick:p=>l.toggleDisponibilite(s),class:"text-sm text-primary hover:text-primary-dark"},f(s.disponible?"Marquer comme indisponible":"Marquer comme disponible"),9,se)])]))),128))]),l.showAddModal?(c(),m("div",le,[t("div",ie,[t("div",ae,[t("h3",oe,f(l.editMode?"Modifier":"Ajouter")+" un thème",1)]),t("form",{onSubmit:e[5]||(e[5]=L((...s)=>l.saveTheme&&l.saveTheme(...s),["prevent"])),class:"p-6"},[t("div",ne,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Titre",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>l.formData.titre=s),required:"",class:"mt-1 input-field"},null,512),[[S,l.formData.titre]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),g(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.formData.description=s),rows:"4",class:"mt-1 input-field"},null,512),[[S,l.formData.description]])]),t("div",re,[g(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>l.formData.disponible=s),id:"disponible",class:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"},null,512),[[G,l.formData.disponible]]),e[17]||(e[17]=t("label",{for:"disponible",class:"ml-2 block text-sm text-gray-700"}," Disponible pour affectation ",-1))])]),t("div",de,[t("button",{type:"button",onClick:e[4]||(e[4]=s=>l.showAddModal=!1),class:"btn-outline"}," Annuler "),t("button",ue,f(l.editMode?"Enregistrer":"Ajouter"),1)])],32)])])):F("",!0)]),t("div",me,[e[25]||(e[25]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Affecter un thème",-1)),t("div",ce,[t("div",fe,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"Filtrer par statut",-1)),g(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.filtreStatut=s),class:"mt-1 input-field"},e[18]||(e[18]=[t("option",{value:""},"Tous les thèmes",-1),t("option",{value:"disponible"},"Disponibles",-1),t("option",{value:"non_disponible"},"Non disponibles",-1)]),512),[[D,l.filtreStatut]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700"},"Rechercher un thème",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>l.searchTheme=s),placeholder:"Titre du thème...",class:"mt-1 input-field"},null,512),[[S,l.searchTheme]])])]),t("div",ve,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700"},"Sélectionner un stagiaire",-1)),g(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.selectedStagiaire=s),class:"mt-1 input-field"},[e[21]||(e[21]=t("option",{value:""},"Choisir un stagiaire",-1)),(c(!0),m(C,null,M(l.stagiaires,s=>(c(),m("option",{key:s.id,value:s.id},f(s.nom),9,pe))),128))],512),[[D,l.selectedStagiaire]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"Sélectionner un thème",-1)),g(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.selectedTheme=s),class:"mt-1 input-field"},[e[23]||(e[23]=t("option",{value:""},"Choisir un thème",-1)),(c(!0),m(C,null,M(l.filteredThemes,s=>(c(),m("option",{key:s.id,value:s.id,disabled:!s.disponible},f(s.titre),9,be))),128))],512),[[D,l.selectedTheme]])]),t("button",{onClick:e[10]||(e[10]=(...s)=>l.affecterTheme&&l.affecterTheme(...s)),class:"btn-primary w-full",disabled:!l.selectedStagiaire||!l.selectedTheme}," Affecter le thème ",8,ge)])])])],64)}const he=B(K,[["render",ye]]);export{he as default};
