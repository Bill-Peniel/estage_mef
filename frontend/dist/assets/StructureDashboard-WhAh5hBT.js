import{_ as N,r as h,c as S,o as w,b as e,d as a,w as i,e as n,n as d,O as C,t as $,h as E,P as U,u as z,A as B,f as b,q as P,g as j,p as L,Q as O,R as V}from"./index-C-Ksv_Lv.js";import{N as F}from"./NotificationDropdown-CsOJw8Ca.js";const R={name:"SidebarStructure",data(){return{isSidebarOpen:!0}}},q={class:"p-4"},J={class:"mt-6"},T={class:"mt-6"},Q={class:"mt-6"},G={class:"mt-6"};function H(o,t,c,r,p,_){const l=h("router-link");return w(),S("aside",{class:d(["bg-gradient-to-t from-slate-400 to-white w-64 text-white shadow-lg overflow-y-auto transform transition-all duration-300 ease-in-out fixed md:translate-x-0 z-50 sidebar-custom-scroll",{"-translate-x-full":!p.isSidebarOpen}])},[e("nav",q,[a(l,{to:"/dashboard/structure",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure"}])},{default:i(()=>t[0]||(t[0]=[e("i",{class:"fas fa-chart-line mr-2"},null,-1),n(" Vue d'ensemble ")])),_:1},8,["class"]),e("div",J,[t[3]||(t[3]=e("h3",{class:"px-4 py-2 text-sm font-semibold text-slate-500 uppercase"},"Stagiaires",-1)),a(l,{to:"/dashboard/structure/stagiaires",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/stagiaires"}])},{default:i(()=>t[1]||(t[1]=[e("i",{class:"fas fa-users mr-2"},null,-1),n(" Stagiaires ")])),_:1},8,["class"]),a(l,{to:"/dashboard/structure/evaluations",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/evaluations"}])},{default:i(()=>t[2]||(t[2]=[e("i",{class:"fas fa-star mr-2"},null,-1),n(" Évaluations ")])),_:1},8,["class"])]),e("div",T,[t[5]||(t[5]=e("h3",{class:"px-4 py-2 text-sm font-semibold text-slate-500 uppercase"},"Sous-structures",-1)),a(l,{to:"/dashboard/structure/sousStructures",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/sousStructures"}])},{default:i(()=>t[4]||(t[4]=[e("i",{class:"fas fa-building mr-2"},null,-1),n(" Sous-structures ")])),_:1},8,["class"])]),e("div",Q,[t[8]||(t[8]=e("h3",{class:"px-4 py-2 text-sm font-semibold text-slate-500 uppercase"},"Agents",-1)),a(l,{to:"/dashboard/structure/tuteurs",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/tuteurs"}])},{default:i(()=>t[6]||(t[6]=[e("i",{class:"fas fa-chalkboard-teacher mr-2"},null,-1),n(" Agents ")])),_:1},8,["class"]),a(l,{to:"/dashboard/structure/affectations",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/affectations"}])},{default:i(()=>t[7]||(t[7]=[e("i",{class:"fas fa-user-plus mr-2"},null,-1),n(" Affectations ")])),_:1},8,["class"])]),e("div",G,[t[11]||(t[11]=e("h3",{class:"px-4 py-2 text-sm font-semibold text-slate-500 uppercase"},"Paramètres",-1)),a(l,{to:"/dashboard/structure/profil",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/profil"}])},{default:i(()=>t[9]||(t[9]=[e("i",{class:"fas fa-user mr-2"},null,-1),n(" Profil ")])),_:1},8,["class"]),a(l,{to:"/dashboard/structure/notifications",class:d(["text-slate-900 block px-4 py-2 rounded hover:bg-slate-400 hover:text-slate-700 transition-colors duration-200",{"bg-slate-500 text-white":o.$route.path==="/dashboard/structure/notifications"}])},{default:i(()=>t[10]||(t[10]=[e("i",{class:"fas fa-bell mr-2"},null,-1),n(" Notifications ")])),_:1},8,["class"])])])],2)}const K=N(R,[["render",H],["__scopeId","data-v-2b5eec9e"]]),W={name:"StructureDashboard",components:{SidebarStructure:K,NotificationDropdown:F},setup(){const o=z(),t=B(),c=b(!1),r=b(null),p=b(""),_=b({stagiairesActifs:5,evaluationsEnAttente:2,stagesTermines:8}),l=b([{id:1,nom:"Jean Dupont",email:"jean.dupont@email.com",typeStage:"Stage académique",dateDebut:"2024-02-01",dateFin:"2024-04-30",tuteur:"Marie Martin"},{id:2,nom:"Alice Bernard",email:"alice.bernard@email.com",typeStage:"Stage professionnel",dateDebut:"2024-03-01",dateFin:"2024-05-31",tuteur:"Paul Dubois"}]),x=P(()=>{var u;const s=o.state.user;return((u=s==null?void 0:s.name)==null?void 0:u.charAt(0).toUpperCase())||"U"}),y=s=>new Date(s).toLocaleDateString("fr-FR"),k=async()=>{await o.dispatch("logout"),t.push("/login")},f=s=>{r.value&&!r.value.contains(s.target)&&(c.value=!1)},M=async()=>{try{const s=o.state.user;console.log("Données utilisateur dans le store:",s);const u=JSON.parse(localStorage.getItem("user"));console.log("Données utilisateur dans le localStorage:",u),!s&&u&&await o.dispatch("setUser",u);const D=await V.getStructures();console.log("Structures reçues:",D);const g=D.find(m=>{var v;return(v=m.tuteurs)==null?void 0:v.some(I=>I.userId===((s==null?void 0:s.id)||(u==null?void 0:u.id)))});if(console.log("Structure trouvée:",g),g)if(g.parentId){const m=D.find(v=>v.id===g.parentId);m&&(p.value=m.sigle,console.log("Sigle de la structure parente:",m.sigle))}else p.value=g.sigle,console.log("Sigle de la structure:",g.sigle);else console.error("Structure non trouvée pour l'utilisateur"),o.dispatch("setNotification",{type:"error",message:"Aucune structure trouvée pour votre compte"})}catch(s){console.error("Erreur lors de la récupération du sigle de la structure:",s),o.dispatch("setNotification",{type:"error",message:"Erreur lors de la récupération des données de la structure"})}},A=()=>{c.value=!c.value};return j(()=>{document.addEventListener("click",f),M()}),L(()=>o.state.user,s=>{console.log("Données utilisateur mises à jour:",s),s&&s.role==="structure"&&M()},{deep:!0,immediate:!0}),O(()=>{document.removeEventListener("click",f)}),{store:o,stats:_,stagiaires:l,showUserMenu:c,userMenu:r,userInitials:x,toggleUserMenu:A,formatDate:y,logout:k,structureSigle:p}}},X={class:"min-h-screen bg-gray-100 flex flex-col"},Y={class:"bg-slate-800 shadow-md shadow-[0_4px_6px_-1px_rgba(0,0,0,0.6)] fixed top-0 w-full z-20"},Z={class:"px-4 py-4 flex justify-between items-center"},tt={class:"flex items-center gap-4"},et={class:"text-2xl font-bold text-white"},st={key:0,class:"text-accent-yellow"},ot={key:1},rt={class:"flex items-center space-x-4"},at={class:"text-white"},lt={class:"relative",ref:"userMenu"},nt={class:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition"},it={class:"text-sm font-medium"},ut={class:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50"},dt={class:"flex pt-20"},ct={class:"flex-1 md:ml-64 p-6 bg-gray-50"};function pt(o,t,c,r,p,_){const l=h("NotificationDropdown"),x=h("router-link"),y=h("SidebarStructure"),k=h("router-view");return w(),S("div",X,[e("header",Y,[e("div",Z,[e("div",tt,[t[3]||(t[3]=e("img",{src:C,alt:"Logo du ministère",class:"h-12 w-auto"},null,-1)),e("h1",et,[r.structureSigle?(w(),S("span",st,$(r.structureSigle),1)):(w(),S("span",ot,"Structure")),t[2]||(t[2]=e("span",{class:"ml-2"},"- e-Stage",-1))])]),e("div",rt,[e("span",at,$(r.store.getters.roleDisplay),1),a(l),e("div",lt,[e("button",{onClick:t[0]||(t[0]=(...f)=>r.toggleUserMenu&&r.toggleUserMenu(...f)),class:"flex items-center space-x-3 focus:outline-none"},[e("div",nt,[e("span",it,$(r.userInitials),1)])]),E(e("div",ut,[a(x,{to:"/dashboard/structure/profil",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:i(()=>t[4]||(t[4]=[e("i",{class:"fas fa-user mr-2"},null,-1),n(" Mon profil ")])),_:1}),a(x,{to:"/dashboard/structure/parametres",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:i(()=>t[5]||(t[5]=[e("i",{class:"fas fa-cog mr-2"},null,-1),n(" Paramètres ")])),_:1}),e("button",{onClick:t[1]||(t[1]=(...f)=>r.logout&&r.logout(...f)),class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100"},t[6]||(t[6]=[e("i",{class:"fas fa-sign-out-alt mr-2"},null,-1),n(" Déconnexion ")]))],512),[[U,r.showUserMenu]])],512)])])]),e("div",dt,[a(y,{class:"fixed left-0 top-20 h-[calc(100vh-4rem)] z-10"}),e("div",ct,[a(k)])])])}const mt=N(W,[["render",pt]]);export{mt as default};
