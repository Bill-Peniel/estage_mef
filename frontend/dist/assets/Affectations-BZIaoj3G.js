import{_ as x,V as y,c as a,o as n,b as t,h as g,m as h,F as c,j as f,t as o,G as d,H as v}from"./index-C-Ksv_Lv.js";const _={name:"Affectations",components:{Notification:y},setup(){return{notification:v()}},data(){return{selectedStagiaire:"",selectedTuteur:"",stagiaires:[],tuteurs:[],affectations:[],loading:!1}},computed:{stagiairesNonAffectes(){const i=this.affectations.map(e=>e.userId);return this.stagiaires.filter(e=>!i.includes(e.userId))}},methods:{async fetchData(){try{this.loading=!0;const i=await d.get("/affectations/stagiaires");this.stagiaires=i.data.map(r=>({id:r.userId,nom:r.user.profile.nom,prenom:r.user.profile.prenom}));const e=await d.get("/affectations/tuteurs");this.tuteurs=e.data.map(r=>({id:r.userId,nom:r.user.profile.nom,prenom:r.user.profile.prenom,fonction:r.user.profile.fonction||"Tuteur",structure:r.structure}));const p=await d.get("/affectations");this.affectations=p.data.map(r=>({id:r.userId,stagiaire:`${r.user.profile.prenom} ${r.user.profile.nom}`,tuteur:{nom:`${r.tuteur.user.profile.prenom} ${r.tuteur.user.profile.nom}`,structure:r.tuteur.structure},dateAffectation:r.user.createdAt}))}catch(i){this.notification.error("Erreur lors du chargement des données"),console.error("Erreur:",i)}finally{this.loading=!1}},async affecter(){if(!this.selectedStagiaire||!this.selectedTuteur){this.notification.warning("Veuillez sélectionner un stagiaire et un tuteur");return}try{this.loading=!0,await d.post("/affectations",{stagiaireId:this.selectedStagiaire,tuteurId:this.selectedTuteur}),this.notification.success("Affectation créée avec succès"),this.selectedStagiaire="",this.selectedTuteur="",await this.fetchData()}catch(i){this.notification.error("Erreur lors de la création de l'affectation"),console.error("Erreur:",i)}finally{this.loading=!1}},async supprimerAffectation(i){if(confirm("Êtes-vous sûr de vouloir supprimer cette affectation ?"))try{this.loading=!0,await d.delete(`/affectations/${i}`),this.notification.success("Affectation supprimée avec succès"),await this.fetchData()}catch(e){this.notification.error("Erreur lors de la suppression de l'affectation"),console.error("Erreur:",e)}finally{this.loading=!1}},formatDate(i){if(!i)return"Non définie";try{const e=new Date(i);return isNaN(e.getTime())?"Date invalide":e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Date invalide"}}},mounted(){this.fetchData()}},w={class:"p-6"},b={class:"bg-white rounded-lg shadow p-6"},A={class:"mb-6"},S={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},D=["value"],k=["value"],T={class:"mt-8"},N={class:"overflow-x-auto"},I={class:"min-w-full divide-y divide-gray-200"},E={class:"bg-white divide-y divide-gray-200"},V={class:"px-6 py-4 whitespace-nowrap"},R={class:"px-6 py-4 whitespace-nowrap"},B={class:"flex items-center"},C={class:"flex-shrink-0 h-10 w-10"},F=["src"],j={class:"ml-4"},L={class:"text-sm font-medium text-gray-900"},U={class:"text-sm text-gray-500"},z={class:"text-xs text-gray-400"},G={class:"px-6 py-4 whitespace-nowrap"},H={class:"px-6 py-4 whitespace-nowrap"},M={class:"px-6 py-4 whitespace-nowrap"},O=["onClick"];function q(i,e,p,r,u,l){return n(),a("div",w,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold mb-6"},"Affectation des Tuteurs",-1)),t("div",b,[t("div",A,[e[7]||(e[7]=t("h2",{class:"text-lg font-semibold mb-4"},"Nouvelle Affectation",-1)),t("div",S,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Stagiaire",-1)),g(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.selectedStagiaire=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"},[e[3]||(e[3]=t("option",{value:""},"Sélectionner un stagiaire",-1)),(n(!0),a(c,null,f(l.stagiairesNonAffectes,s=>(n(),a("option",{key:s.id,value:s.id},o(s.nom)+" "+o(s.prenom),9,D))),128))],512),[[h,u.selectedStagiaire]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tuteur",-1)),g(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>u.selectedTuteur=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"},[e[5]||(e[5]=t("option",{value:""},"Sélectionner un tuteur",-1)),(n(!0),a(c,null,f(u.tuteurs,s=>(n(),a("option",{key:s.id,value:s.id},o(s.nom)+" "+o(s.prenom)+" - "+o(s.fonction)+" ("+o(s.structure.nomStructure)+") ",9,k))),128))],512),[[h,u.selectedTuteur]])])]),t("button",{onClick:e[2]||(e[2]=(...s)=>l.affecter&&l.affecter(...s)),class:"mt-4 bg-primary text-white px-4 py-2 rounded hover:bg-primary-700"}," Affecter ")]),t("div",T,[e[10]||(e[10]=t("h2",{class:"text-lg font-semibold mb-4"},"Affectations en cours",-1)),t("div",N,[t("table",I,[e[9]||(e[9]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Stagiaire"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tuteur"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Structure du tuteur"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Date d'affectation"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),t("tbody",E,[(n(!0),a(c,null,f(u.affectations,s=>{var m;return n(),a("tr",{key:s.id},[t("td",V,o(s.stagiaire),1),t("td",R,[t("div",B,[t("div",C,[t("img",{class:"h-10 w-10 rounded-full",src:s.tuteur.photo||"/default-avatar.png",alt:""},null,8,F)]),t("div",j,[t("div",L,o(s.tuteur.nom)+" "+o(s.tuteur.prenom),1),t("div",U,o(s.tuteur.fonction),1),t("div",z,o((m=s.tuteur.structure)==null?void 0:m.nom),1)])])]),t("td",G,o(s.tuteur.structure.nomStructure),1),t("td",H,o(l.formatDate(s.dateAffectation)),1),t("td",M,[t("button",{onClick:J=>l.supprimerAffectation(s.id),class:"text-red-600 hover:text-red-800"},e[8]||(e[8]=[t("i",{class:"fas fa-trash"},null,-1)]),8,O)])])}),128))])])])])])])}const P=x(_,[["render",q],["__scopeId","data-v-d0f81a3d"]]);export{P as default};
