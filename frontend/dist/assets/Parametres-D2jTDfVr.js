import{_ as M,c as n,o as d,b as s,d as F,w as S,i as v,n as h,e as b,t as D,T as I,h as m,v as c,x as C,u as L,f as p,g as R,N as g}from"./index-C-Ksv_Lv.js";const U="https://ui-avatars.com/api/?name=Utilisateur&background=7e3af2&color=fff&size=128",z={name:"Parametres",setup(){const w=L(),e=p({prenom:"",nom:"",email:"",telephone:"",avatar:""}),u=p({oldPassword:"",newPassword:"",confirmPassword:""}),a=p({email:!0,site:!0}),i=p({profile:!1,password:!1,notifications:!1,avatar:!1}),y=p({message:"",success:!0}),t=p(null),x=p("");let P=null;const V=o=>o?o.startsWith("http://")||o.startsWith("https://")?o:`http://localhost:3002/uploads/${o}`:U,k=async()=>{var o,l;try{const f=await g.getProfile();e.value={prenom:f.prenom||"",nom:f.nom||"",email:f.email||"",telephone:f.telephone||"",avatar:f.avatar||""},a.value={email:((o=f.notifications)==null?void 0:o.email)??!0,site:((l=f.notifications)==null?void 0:l.site)??!0}}catch{r("Erreur lors du chargement du profil",!1)}},A=o=>{const l=o.target.files[0];if(l){if(!l.type.startsWith("image/")){r("Le fichier doit être une image",!1);return}if(l.size>2*1024*1024){r("Image trop volumineuse (max 2Mo)",!1);return}t.value=l,x.value=URL.createObjectURL(l)}},N=async()=>{if(t.value){i.value.avatar=!0;try{const o=new FormData;o.append("avatar",t.value);const l=await g.uploadAvatar(o);await k(),w.commit("setUser",{...w.state.user,avatar:e.value.avatar}),t.value=null,x.value="",r("Photo de profil mise à jour !",!0)}catch(o){r(o.message||"Erreur lors de l'upload de la photo",!1)}i.value.avatar=!1}},E=async()=>{i.value.profile=!0;try{await g.updateProfile({prenom:e.value.prenom,nom:e.value.nom,email:e.value.email,telephone:e.value.telephone}),r("Profil mis à jour avec succès",!0)}catch(o){r(o.message||"Erreur lors de la mise à jour du profil",!1)}i.value.profile=!1},j=async()=>{if(u.value.newPassword!==u.value.confirmPassword){r("Les mots de passe ne correspondent pas",!1);return}i.value.password=!0;try{await g.changePassword({oldPassword:u.value.oldPassword,newPassword:u.value.newPassword}),r("Mot de passe changé avec succès",!0),u.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(o){r(o.message||"Erreur lors du changement de mot de passe",!1)}i.value.password=!1},T=async()=>{i.value.notifications=!0;try{await g.updateNotificationPreferences(a.value),r("Préférences de notification mises à jour",!0)}catch(o){r(o.message||"Erreur lors de la mise à jour des préférences",!1)}i.value.notifications=!1},r=(o,l=!0)=>{y.value={message:o,success:l},P&&clearTimeout(P),P=setTimeout(()=>{y.value.message=""},3500)};return R(()=>{k()}),{profile:e,security:u,notifications:a,loading:i,snackbar:y,avatarFile:t,avatarPreview:x,defaultAvatar:U,getAvatarUrl:V,onAvatarChange:A,uploadAvatar:N,saveProfile:E,changePassword:j,saveNotificationPreferences:T}}},B={class:"p-6 min-h-screen settings-bg"},G={class:"bg-white rounded-lg shadow-sm p-6"},W={class:"mb-8 flex items-center gap-6"},J={class:"relative"},O=["src"],q={key:1,class:"w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center border-4 border-primary shadow"},H={class:"absolute bottom-0 right-0 bg-primary text-white rounded-full p-2 cursor-pointer shadow-lg hover:bg-primary-dark transition",title:"Changer la photo"},K=["disabled"],Q={key:0,class:"loader mr-2"},X={class:"mb-8"},Y={class:"space-y-4"},Z=["disabled"],_={key:0,class:"loader mr-2"},$={class:"border-t pt-8 mb-8"},ee={class:"space-y-4"},se=["disabled"],ae={key:0,class:"loader mr-2"},te={class:"border-t pt-8"},oe={class:"space-y-4"},re={class:"flex items-center"},le={class:"flex items-center"},ie=["disabled"],ne={key:0,class:"loader mr-2"};function de(w,e,u,a,i,y){return d(),n("div",B,[e[34]||(e[34]=s("h1",{class:"text-2xl font-bold text-gray-800 mb-6"},"Paramètres",-1)),F(I,{name:"snackbar-fade"},{default:S(()=>[a.snackbar.message?(d(),n("div",{key:0,class:h(["snackbar",a.snackbar.success?"snackbar-success":"snackbar-error"])},[s("i",{class:h([a.snackbar.success?"fas fa-check-circle":"fas fa-exclamation-triangle","mr-2"])},null,2),b(" "+D(a.snackbar.message),1)],2)):v("",!0)]),_:1}),s("div",G,[s("div",W,[s("div",J,[a.avatarPreview||a.profile.avatar?(d(),n("img",{key:0,src:a.avatarPreview||a.getAvatarUrl(a.profile.avatar),alt:"Avatar",class:"w-24 h-24 rounded-full object-cover border-4 border-primary shadow"},null,8,O)):(d(),n("div",q,e[14]||(e[14]=[s("i",{class:"fas fa-user text-gray-400 text-5xl"},null,-1)]))),s("label",H,[e[15]||(e[15]=s("i",{class:"fas fa-camera"},null,-1)),s("input",{type:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...t)=>a.onAvatarChange&&a.onAvatarChange(...t))},null,32)])]),s("div",null,[e[17]||(e[17]=s("p",{class:"font-semibold text-gray-700"},"Photo de profil",-1)),e[18]||(e[18]=s("p",{class:"text-xs text-gray-500"},"Formats acceptés : JPG, PNG, GIF. Max 2Mo.",-1)),a.avatarFile?(d(),n("button",{key:0,onClick:e[1]||(e[1]=(...t)=>a.uploadAvatar&&a.uploadAvatar(...t)),class:"btn-primary mt-2",disabled:a.loading.avatar},[a.loading.avatar?(d(),n("span",Q)):v("",!0),e[16]||(e[16]=b(" Enregistrer la nouvelle photo "))],8,K)):v("",!0)])]),s("div",X,[e[24]||(e[24]=s("h2",{class:"text-lg font-semibold text-gray-700 mb-4"},"Informations personnelles",-1)),s("div",Y,[s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700"},"Prénom",-1)),m(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>a.profile.prenom=t),class:"mt-1 input-field"},null,512),[[c,a.profile.prenom]])]),s("div",null,[e[20]||(e[20]=s("label",{class:"block text-sm font-medium text-gray-700"},"Nom",-1)),m(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>a.profile.nom=t),class:"mt-1 input-field"},null,512),[[c,a.profile.nom]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),m(s("input",{type:"email","onUpdate:modelValue":e[4]||(e[4]=t=>a.profile.email=t),class:"mt-1 input-field"},null,512),[[c,a.profile.email]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700"},"Téléphone",-1)),m(s("input",{type:"tel","onUpdate:modelValue":e[5]||(e[5]=t=>a.profile.telephone=t),class:"mt-1 input-field"},null,512),[[c,a.profile.telephone]])])]),s("button",{onClick:e[6]||(e[6]=(...t)=>a.saveProfile&&a.saveProfile(...t)),class:"btn-primary mt-4",disabled:a.loading.profile},[a.loading.profile?(d(),n("span",_)):v("",!0),e[23]||(e[23]=b(" Enregistrer les modifications "))],8,Z)]),s("div",$,[e[29]||(e[29]=s("h2",{class:"text-lg font-semibold text-gray-700 mb-4"},"Sécurité",-1)),s("div",ee,[s("div",null,[e[25]||(e[25]=s("label",{class:"block text-sm font-medium text-gray-700"},"Ancien mot de passe",-1)),m(s("input",{type:"password","onUpdate:modelValue":e[7]||(e[7]=t=>a.security.oldPassword=t),class:"mt-1 input-field"},null,512),[[c,a.security.oldPassword]])]),s("div",null,[e[26]||(e[26]=s("label",{class:"block text-sm font-medium text-gray-700"},"Nouveau mot de passe",-1)),m(s("input",{type:"password","onUpdate:modelValue":e[8]||(e[8]=t=>a.security.newPassword=t),class:"mt-1 input-field"},null,512),[[c,a.security.newPassword]])]),s("div",null,[e[27]||(e[27]=s("label",{class:"block text-sm font-medium text-gray-700"},"Confirmer le mot de passe",-1)),m(s("input",{type:"password","onUpdate:modelValue":e[9]||(e[9]=t=>a.security.confirmPassword=t),class:"mt-1 input-field"},null,512),[[c,a.security.confirmPassword]])])]),s("button",{onClick:e[10]||(e[10]=(...t)=>a.changePassword&&a.changePassword(...t)),class:"btn-primary mt-4",disabled:a.loading.password},[a.loading.password?(d(),n("span",ae)):v("",!0),e[28]||(e[28]=b(" Changer le mot de passe "))],8,se)]),s("div",te,[e[33]||(e[33]=s("h2",{class:"text-lg font-semibold text-gray-700 mb-4"},"Préférences de notification",-1)),s("div",oe,[s("div",re,[m(s("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>a.notifications.email=t),id:"email-notif",class:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"},null,512),[[C,a.notifications.email]]),e[30]||(e[30]=s("label",{for:"email-notif",class:"ml-2 block text-sm text-gray-700"}," Recevoir les notifications par email ",-1))]),s("div",le,[m(s("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=t=>a.notifications.site=t),id:"site-notif",class:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"},null,512),[[C,a.notifications.site]]),e[31]||(e[31]=s("label",{for:"site-notif",class:"ml-2 block text-sm text-gray-700"}," Recevoir les notifications sur le site ",-1))])]),s("button",{onClick:e[13]||(e[13]=(...t)=>a.saveNotificationPreferences&&a.saveNotificationPreferences(...t)),class:"btn-primary mt-4",disabled:a.loading.notifications},[a.loading.notifications?(d(),n("span",ne)):v("",!0),e[32]||(e[32]=b(" Enregistrer les préférences "))],8,ie)])])])}const fe=M(z,[["render",de],["__scopeId","data-v-d04f80b7"]]);export{fe as default};
