import{_ as N,c as m,o as g,b as s,i as v,h as n,v as f,x,E as k,t as p,f as u,g as C,C as E}from"./index-C-Ksv_Lv.js";const M="https://ui-avatars.com/api/?name=Stagiaire&background=E5E7EB&color=374151&size=128",V={name:"StagiaireParametres",setup(){const a=u({avatar:"",firstName:"",lastName:"",email:"",telephone:"",birthDate:"",school:"",major:"",currentPassword:"",newPassword:"",confirmPassword:"",notifMessages:!0,notifEvaluation:!0,notifRapports:!0}),e=u(""),S=u(!1),t=u(""),c=u(""),w=u(!1),o=u(!0),b=u(""),y=u(""),h=u(!1);return C(async()=>{o.value=!0;try{const i=localStorage.getItem("token"),l=(await E.get("/api/users/me",{headers:{Authorization:`Bearer ${i}`}})).data;a.value={avatar:l.avatar||"",firstName:l.firstName||"",lastName:l.lastName||"",email:l.email||"",telephone:l.telephone||"",birthDate:l.birthDate?l.birthDate.substr(0,10):"",school:l.school||"",major:l.major||"",currentPassword:"",newPassword:"",confirmPassword:"",notifMessages:l.notifMessages??!0,notifEvaluation:l.notifEvaluation??!0,notifRapports:l.notifRapports??!0},e.value=""}catch{b.value="Erreur lors du chargement du profil."}finally{o.value=!1}}),{settings:a,avatarPreview:e,defaultAvatar:M,saveSettings:async()=>{var i,d;b.value="",y.value="",h.value=!0;try{const l=localStorage.getItem("token");let r,P;a.value.avatarFile?(r=new FormData,r.append("firstName",a.value.firstName),r.append("lastName",a.value.lastName),r.append("email",a.value.email),r.append("telephone",a.value.telephone),r.append("birthDate",a.value.birthDate),r.append("school",a.value.school),r.append("major",a.value.major),r.append("notifMessages",a.value.notifMessages),r.append("notifEvaluation",a.value.notifEvaluation),r.append("notifRapports",a.value.notifRapports),r.append("avatar",a.value.avatarFile),P={Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}):(r={firstName:a.value.firstName,lastName:a.value.lastName,email:a.value.email,telephone:a.value.telephone,birthDate:a.value.birthDate,school:a.value.school,major:a.value.major,notifMessages:a.value.notifMessages,notifEvaluation:a.value.notifEvaluation,notifRapports:a.value.notifRapports},P={Authorization:`Bearer ${l}`}),await E.put("/api/users/me",r,{headers:P}),y.value="Profil mis à jour avec succès.",a.value.avatarFile&&(a.value.avatar=e.value,a.value.avatarFile=void 0,e.value="")}catch(l){b.value=((d=(i=l.response)==null?void 0:i.data)==null?void 0:d.message)||"Erreur lors de la sauvegarde."}finally{h.value=!1}},resetSettings:()=>{window.location.reload()},changePassword:async()=>{var i,d;if(t.value="",c.value="",!a.value.currentPassword||!a.value.newPassword||!a.value.confirmPassword){t.value="Veuillez remplir tous les champs de mot de passe.";return}if(a.value.newPassword!==a.value.confirmPassword){t.value="Les nouveaux mots de passe ne correspondent pas.";return}w.value=!0;try{const l=localStorage.getItem("token");await E.post("/api/users/me/password",{currentPassword:a.value.currentPassword,newPassword:a.value.newPassword},{headers:{Authorization:`Bearer ${l}`}}),c.value="Mot de passe modifié avec succès.",a.value.currentPassword="",a.value.newPassword="",a.value.confirmPassword=""}catch(l){t.value=((d=(i=l.response)==null?void 0:i.data)==null?void 0:d.message)||"Erreur lors de la modification du mot de passe."}finally{w.value=!1}},showPasswords:S,passwordError:t,passwordSuccess:c,isPasswordLoading:w,isLoading:o,saveError:b,saveSuccess:y,isSaving:h,onAvatarChange:i=>{const d=i.target.files[0];if(d){const l=new FileReader;l.onload=r=>{e.value=r.target.result},l.readAsDataURL(d),a.value.avatarFile=d}}}}},D={class:"min-h-screen settings-bg flex flex-col items-center p-6 justify-center py-10"},U={class:"bg-white rounded-2xl shadow-lg border border-gray-200 w-full max-w-2xl mx-auto px-6 sm:px-10 py-6 top-10 mb-4 relative"},j={class:"flex flex-col items-center mb-8"},A={class:"relative group"},R=["src"],B={class:"absolute bottom-2 right-2 bg-indigo-600 text-white rounded-full p-3 cursor-pointer shadow-lg hover:bg-indigo-700 transition flex items-center justify-center group-hover:scale-110",title:"Changer l'avatar"},z={key:0,class:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-indigo-600 bg-indigo-50 px-2 py-1 rounded shadow"},F={class:"mb-10"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},I={class:"md:col-span-2"},T={class:"mb-10"},q={class:"flex flex-wrap gap-6"},G={class:"flex items-center gap-2"},H={class:"flex items-center gap-2"},J={class:"flex items-center gap-2"},K={class:"mb-10"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Q={class:"md:col-span-2"},W=["type"],X=["type"],Y=["type"],Z={class:"flex items-center gap-2 mt-2"},_={key:0,class:"text-red-600 bg-red-50 border border-red-200 rounded p-2 text-sm mt-2"},$={key:1,class:"text-green-700 bg-green-50 border border-green-200 rounded p-2 text-sm mt-2"},ee={class:"flex justify-end mt-4"},se=["disabled"],te={key:0},ae={class:"flex flex-col md:flex-row justify-end gap-3 mt-8"},oe=["disabled"],le={key:0},re={key:0,class:"text-red-600 bg-red-50 border border-red-200 rounded p-2 text-sm mt-2"},ne={key:1,class:"text-green-700 bg-green-50 border border-green-200 rounded p-2 text-sm mt-2"};function ie(a,e,S,t,c,w){return g(),m("div",D,[s("div",U,[s("div",j,[s("div",A,[s("img",{src:t.avatarPreview||t.settings.avatar||t.defaultAvatar,alt:"Avatar",class:"w-32 h-32 rounded-full object-cover border-4 border-indigo-200 shadow-lg transition group-hover:brightness-90"},null,8,R),s("label",B,[s("input",{type:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...o)=>t.onAvatarChange&&t.onAvatarChange(...o))},null,32),e[18]||(e[18]=s("i",{class:"fas fa-camera"},null,-1))]),t.avatarPreview?(g(),m("div",z,"Aperçu de la nouvelle image")):v("",!0)])]),e[38]||(e[38]=s("h2",{class:"text-2xl font-extrabold text-gray-800 text-center mb-10 tracking-tight"},"Paramètres du compte",-1)),s("div",F,[e[26]||(e[26]=s("h3",{class:"text-lg font-semibold text-indigo-700 mb-6 tracking-wide border-l-4 border-indigo-400 pl-3"},"Informations personnelles",-1)),s("div",L,[s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Prénom",-1)),n(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>t.settings.firstName=o),class:"input-field w-full"},null,512),[[f,t.settings.firstName]])]),s("div",null,[e[20]||(e[20]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nom",-1)),n(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>t.settings.lastName=o),class:"input-field w-full"},null,512),[[f,t.settings.lastName]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),n(s("input",{type:"email","onUpdate:modelValue":e[3]||(e[3]=o=>t.settings.email=o),class:"input-field w-full"},null,512),[[f,t.settings.email]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Téléphone",-1)),n(s("input",{type:"tel","onUpdate:modelValue":e[4]||(e[4]=o=>t.settings.telephone=o),class:"input-field w-full"},null,512),[[f,t.settings.telephone]])]),s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date de naissance",-1)),n(s("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=o=>t.settings.birthDate=o),class:"input-field w-full"},null,512),[[f,t.settings.birthDate]])]),s("div",null,[e[24]||(e[24]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"École / Université de provenance",-1)),n(s("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=o=>t.settings.school=o),class:"input-field w-full"},null,512),[[f,t.settings.school]])]),s("div",I,[e[25]||(e[25]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Filière",-1)),n(s("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=o=>t.settings.major=o),class:"input-field w-full"},null,512),[[f,t.settings.major]])])])]),s("div",T,[e[30]||(e[30]=s("h3",{class:"text-lg font-semibold text-indigo-700 mb-6 tracking-wide border-l-4 border-indigo-400 pl-3"},"Préférences de notification",-1)),s("div",q,[s("label",G,[n(s("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=o=>t.settings.notifMessages=o),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[x,t.settings.notifMessages]]),e[27]||(e[27]=s("span",{class:"text-sm"},"Nouveaux messages",-1))]),s("label",H,[n(s("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=o=>t.settings.notifEvaluation=o),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[x,t.settings.notifEvaluation]]),e[28]||(e[28]=s("span",{class:"text-sm"},"Évaluations",-1))]),s("label",J,[n(s("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=o=>t.settings.notifRapports=o),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[x,t.settings.notifRapports]]),e[29]||(e[29]=s("span",{class:"text-sm"},"Rapports",-1))])])]),s("div",K,[e[36]||(e[36]=s("h3",{class:"text-lg font-semibold text-indigo-700 mb-6 tracking-wide border-l-4 border-indigo-400 pl-3"},"Modifier le mot de passe",-1)),s("div",O,[s("div",Q,[e[31]||(e[31]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Mot de passe actuel",-1)),n(s("input",{type:t.showPasswords?"text":"password","onUpdate:modelValue":e[11]||(e[11]=o=>t.settings.currentPassword=o),class:"input-field w-full",autocomplete:"current-password"},null,8,W),[[k,t.settings.currentPassword]])]),s("div",null,[e[32]||(e[32]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nouveau mot de passe",-1)),n(s("input",{type:t.showPasswords?"text":"password","onUpdate:modelValue":e[12]||(e[12]=o=>t.settings.newPassword=o),class:"input-field w-full",autocomplete:"new-password"},null,8,X),[[k,t.settings.newPassword]])]),s("div",null,[e[33]||(e[33]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Confirmer le nouveau mot de passe",-1)),n(s("input",{type:t.showPasswords?"text":"password","onUpdate:modelValue":e[13]||(e[13]=o=>t.settings.confirmPassword=o),class:"input-field w-full",autocomplete:"new-password"},null,8,Y),[[k,t.settings.confirmPassword]])])]),s("div",Z,[n(s("input",{type:"checkbox",id:"showPasswords","onUpdate:modelValue":e[14]||(e[14]=o=>t.showPasswords=o),class:"h-4 w-4"},null,512),[[x,t.showPasswords]]),e[34]||(e[34]=s("label",{for:"showPasswords",class:"text-sm text-gray-700 cursor-pointer"},"Afficher les mots de passe",-1))]),t.passwordError?(g(),m("div",_,p(t.passwordError),1)):v("",!0),t.passwordSuccess?(g(),m("div",$,p(t.passwordSuccess),1)):v("",!0),s("div",ee,[s("button",{onClick:e[15]||(e[15]=(...o)=>t.changePassword&&t.changePassword(...o)),class:"btn-primary flex items-center gap-2 w-full md:w-auto",disabled:t.isPasswordLoading||!t.settings.currentPassword||!t.settings.newPassword||!t.settings.confirmPassword||t.settings.newPassword!==t.settings.confirmPassword},[t.isPasswordLoading?(g(),m("span",te,e[35]||(e[35]=[s("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})],-1)]))):v("",!0),s("span",null,p(t.isPasswordLoading?"Enregistrement...":"Enregistrer le nouveau mot de passe"),1)],8,se)])]),s("div",ae,[s("button",{onClick:e[16]||(e[16]=(...o)=>t.resetSettings&&t.resetSettings(...o)),class:"btn-outline w-full md:w-auto"},"Réinitialiser"),s("button",{onClick:e[17]||(e[17]=(...o)=>t.saveSettings&&t.saveSettings(...o)),class:"btn-primary w-full md:w-auto",disabled:t.isSaving},[t.isSaving?(g(),m("span",le,e[37]||(e[37]=[s("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})],-1)]))):v("",!0),s("span",null,p(t.isSaving?"Enregistrement...":"Enregistrer les modifications"),1)],8,oe)]),t.saveError?(g(),m("div",re,p(t.saveError),1)):v("",!0),t.saveSuccess?(g(),m("div",ne,p(t.saveSuccess),1)):v("",!0)])])}const fe=N(V,[["render",ie],["__scopeId","data-v-1c746fab"]]);export{fe as default};
