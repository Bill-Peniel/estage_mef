import{_ as b,c as u,o as l,b as t,i as d,e as g,t as i,F as p,j as m,l as f,h as a,v as c}from"./index-C-Ksv_Lv.js";const y={name:"StructureDetails",data(){return{structure:{children:[],tuteurs:[],stagiaires:[]},showAddSubStructureModal:!1,showEditSubStructureModal:!1,newSubStructure:{nomStructure:"",sigle:"",parentId:null},editingSubStructure:{id:null,nomStructure:"",sigle:"",parentId:null},error:null,success:null}},methods:{async fetchStructureDetails(){try{const o=await fetch(`http://localhost:3002/api/structures/${this.$route.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});o.ok&&(this.structure=await o.json())}catch(o){console.error("Erreur lors de la récupération des détails de la structure:",o)}},async submitSubStructure(){try{this.error=null,this.success=null;const o=await fetch("http://localhost:3002/api/structures",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({...this.newSubStructure,parentId:this.structure.id})}),e=await o.json();o.ok?(this.success="Sous-structure ajoutée avec succès",await this.fetchStructureDetails(),this.showAddSubStructureModal=!1,this.newSubStructure={nomStructure:"",sigle:"",parentId:null}):this.error=e.message||"Erreur lors de la création de la sous-structure"}catch(o){this.error="Erreur de connexion au serveur",console.error("Erreur lors de la création de la sous-structure:",o)}},viewSubStructure(o){this.$router.push(`/structures/${o.id}`)},editSubStructure(o){this.editingSubStructure={id:o.id,nomStructure:o.nomStructure,sigle:o.sigle,parentId:this.structure.id},this.showEditSubStructureModal=!0},async updateSubStructure(){try{this.error=null,this.success=null;const o=await fetch(`http://localhost:3002/api/structures/${this.editingSubStructure.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({nomStructure:this.editingSubStructure.nomStructure,sigle:this.editingSubStructure.sigle,parentId:this.editingSubStructure.parentId})}),e=await o.json();o.ok?(this.success="Sous-structure modifiée avec succès",await this.fetchStructureDetails(),this.showEditSubStructureModal=!1,this.editingSubStructure={id:null,nomStructure:"",sigle:"",parentId:null}):this.error=e.message||"Erreur lors de la modification de la sous-structure"}catch(o){this.error="Erreur de connexion au serveur",console.error("Erreur lors de la modification de la sous-structure:",o)}},async deleteSubStructure(o){if(confirm("Êtes-vous sûr de vouloir supprimer cette sous-structure ?"))try{(await fetch(`http://localhost:3002/api/structures/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok&&await this.fetchStructureDetails()}catch(e){console.error("Erreur lors de la suppression de la sous-structure:",e)}}},mounted(){this.fetchStructureDetails()}},h={class:"min-h-screen bg-gray-100"},S={class:"flex-1"},w={class:"bg-primary shadow"},v={class:"px-4 py-4 flex justify-between items-center"},_={class:"p-6"},k={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},E={key:1,class:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded"},A={class:"bg-white shadow rounded-lg p-6 mb-6"},j={class:"grid grid-cols-2 gap-4"},D={class:"text-lg font-medium"},C={class:"text-lg font-medium"},M={class:"text-lg font-medium"},I={class:"text-lg font-medium"},N={class:"bg-white shadow rounded-lg p-6 mb-6"},T={class:"flex justify-between items-center mb-4"},V={class:"overflow-x-auto"},B={class:"min-w-full divide-y divide-gray-200"},q={class:"bg-white divide-y divide-gray-200"},z={class:"px-6 py-4 whitespace-nowrap"},L={class:"text-sm font-medium text-gray-900"},P={class:"px-6 py-4 whitespace-nowrap"},U={class:"text-sm text-gray-900"},O={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},F=["onClick"],J=["onClick"],H=["onClick"],R={class:"bg-white shadow rounded-lg p-6 mb-6"},G={class:"overflow-x-auto"},K={class:"min-w-full divide-y divide-gray-200"},Q={class:"bg-white divide-y divide-gray-200"},W={class:"px-6 py-4 whitespace-nowrap"},X={class:"text-sm font-medium text-gray-900"},Y={class:"px-6 py-4 whitespace-nowrap"},Z={class:"text-sm text-gray-900"},$={class:"px-6 py-4 whitespace-nowrap"},tt={class:"text-sm text-gray-900"},et={class:"bg-white shadow rounded-lg p-6"},st={class:"overflow-x-auto"},rt={class:"min-w-full divide-y divide-gray-200"},ot={class:"bg-white divide-y divide-gray-200"},it={class:"px-6 py-4 whitespace-nowrap"},ut={class:"text-sm font-medium text-gray-900"},lt={class:"px-6 py-4 whitespace-nowrap"},nt={class:"text-sm text-gray-900"},dt={class:"px-6 py-4 whitespace-nowrap"},at={class:"text-sm text-gray-900"},ct={class:"px-6 py-4 whitespace-nowrap"},pt={class:"text-sm text-gray-900"},mt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center"},xt={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},gt={class:"p-6"},ft={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},bt={class:"grid grid-cols-2 gap-4"},yt={class:"w-full"},ht={class:"w-full"},St={class:"mt-6 flex justify-end space-x-3"},wt={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center"},vt={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},_t={class:"p-6"},kt={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},Et={class:"grid grid-cols-2 gap-4"},At={class:"w-full"},jt={class:"w-full"},Dt={class:"mt-6 flex justify-end space-x-3"};function Ct(o,e,Mt,It,r,n){return l(),u("div",h,[t("div",S,[t("header",w,[t("div",v,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-white"},"Détails de la structure",-1)),t("button",{onClick:e[0]||(e[0]=s=>o.$router.push("/structures")),class:"bg-white text-primary px-4 py-2 rounded hover:bg-gray-100"},e[10]||(e[10]=[t("i",{class:"fas fa-arrow-left mr-2"},null,-1),g(" Retour ")]))])]),t("main",_,[r.error?(l(),u("div",k,i(r.error),1)):d("",!0),r.success?(l(),u("div",E,i(r.success),1)):d("",!0),t("div",A,[e[16]||(e[16]=t("h2",{class:"text-xl font-bold mb-4"},"Informations générales",-1)),t("div",j,[t("div",null,[e[12]||(e[12]=t("p",{class:"text-sm text-gray-600"},"Nom de la structure",-1)),t("p",D,i(r.structure.nomStructure),1)]),t("div",null,[e[13]||(e[13]=t("p",{class:"text-sm text-gray-600"},"Sigle",-1)),t("p",C,i(r.structure.sigle),1)]),t("div",null,[e[14]||(e[14]=t("p",{class:"text-sm text-gray-600"},"Date de création",-1)),t("p",M,i(new Date(r.structure.createdAt).toLocaleDateString()),1)]),t("div",null,[e[15]||(e[15]=t("p",{class:"text-sm text-gray-600"},"Dernière mise à jour",-1)),t("p",I,i(new Date(r.structure.updatedAt).toLocaleDateString()),1)])])]),t("div",N,[t("div",T,[e[18]||(e[18]=t("h2",{class:"text-xl font-bold"},"Sous-structures",-1)),t("button",{onClick:e[1]||(e[1]=s=>r.showAddSubStructureModal=!0),class:"bg-primary text-white px-4 py-2 rounded hover:bg-primary-dark"},e[17]||(e[17]=[t("i",{class:"fas fa-plus mr-2"},null,-1),g(" Ajouter une sous-structure ")]))]),t("div",V,[t("table",B,[e[22]||(e[22]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nom"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sigle"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",q,[(l(!0),u(p,null,m(r.structure.children,s=>(l(),u("tr",{key:s.id},[t("td",z,[t("div",L,i(s.nomStructure),1)]),t("td",P,[t("div",U,i(s.sigle),1)]),t("td",O,[t("button",{onClick:x=>n.viewSubStructure(s),class:"text-primary hover:text-primary-dark mr-3",title:"Voir"},e[19]||(e[19]=[t("i",{class:"fas fa-eye"},null,-1)]),8,F),t("button",{onClick:x=>n.editSubStructure(s),class:"text-primary hover:text-primary-dark mr-3",title:"Modifier"},e[20]||(e[20]=[t("i",{class:"fas fa-edit"},null,-1)]),8,J),t("button",{onClick:x=>n.deleteSubStructure(s.id),class:"text-danger hover:text-red-700",title:"Supprimer"},e[21]||(e[21]=[t("i",{class:"fas fa-trash"},null,-1)]),8,H)])]))),128))])])])]),t("div",R,[e[24]||(e[24]=t("h2",{class:"text-xl font-bold mb-4"},"Tuteurs",-1)),t("div",G,[t("table",K,[e[23]||(e[23]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nom"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Prénom"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email")])],-1)),t("tbody",Q,[(l(!0),u(p,null,m(r.structure.tuteurs,s=>(l(),u("tr",{key:s.id},[t("td",W,[t("div",X,i(s.user.profile.nom),1)]),t("td",Y,[t("div",Z,i(s.user.profile.prenom),1)]),t("td",$,[t("div",tt,i(s.user.email),1)])]))),128))])])])]),t("div",et,[e[26]||(e[26]=t("h2",{class:"text-xl font-bold mb-4"},"Stagiaires",-1)),t("div",st,[t("table",rt,[e[25]||(e[25]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nom"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Prénom"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tuteur")])],-1)),t("tbody",ot,[(l(!0),u(p,null,m(r.structure.stagiaires,s=>(l(),u("tr",{key:s.id},[t("td",it,[t("div",ut,i(s.user.profile.nom),1)]),t("td",lt,[t("div",nt,i(s.user.profile.prenom),1)]),t("td",dt,[t("div",at,i(s.user.email),1)]),t("td",ct,[t("div",pt,i(s.tuteur?`${s.tuteur.user.profile.nom} ${s.tuteur.user.profile.prenom}`:"-"),1)])]))),128))])])])])]),r.showAddSubStructureModal?(l(),u("div",mt,[t("div",xt,[t("div",gt,[e[30]||(e[30]=t("h2",{class:"text-xl font-bold mb-4"},"Ajouter une sous-structure",-1)),t("form",{onSubmit:e[5]||(e[5]=f((...s)=>n.submitSubStructure&&n.submitSubStructure(...s),["prevent"]))},[r.error?(l(),u("div",ft,i(r.error),1)):d("",!0),t("div",bt,[t("div",yt,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom de la structure",-1)),a(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.newSubStructure.nomStructure=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:""},null,512),[[c,r.newSubStructure.nomStructure]])]),t("div",ht,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Sigle",-1)),a(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r.newSubStructure.sigle=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:""},null,512),[[c,r.newSubStructure.sigle]])])]),t("div",St,[t("button",{type:"button",onClick:e[4]||(e[4]=s=>r.showAddSubStructureModal=!1),class:"btn-outline"}," Annuler "),e[29]||(e[29]=t("button",{type:"submit",class:"btn-primary"}," Ajouter ",-1))])],32)])])])):d("",!0),r.showEditSubStructureModal?(l(),u("div",wt,[t("div",vt,[t("div",_t,[e[34]||(e[34]=t("h2",{class:"text-xl font-bold mb-4"},"Modifier la sous-structure",-1)),t("form",{onSubmit:e[9]||(e[9]=f((...s)=>n.updateSubStructure&&n.updateSubStructure(...s),["prevent"]))},[r.error?(l(),u("div",kt,i(r.error),1)):d("",!0),t("div",Et,[t("div",At,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom de la sous-structure",-1)),a(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>r.editingSubStructure.nomStructure=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:""},null,512),[[c,r.editingSubStructure.nomStructure]])]),t("div",jt,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Sigle",-1)),a(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>r.editingSubStructure.sigle=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:""},null,512),[[c,r.editingSubStructure.sigle]])])]),t("div",Dt,[t("button",{type:"button",onClick:e[8]||(e[8]=s=>r.showEditSubStructureModal=!1),class:"btn-outline"}," Annuler "),e[33]||(e[33]=t("button",{type:"submit",class:"btn-primary"}," Enregistrer ",-1))])],32)])])])):d("",!0)])])}const Tt=b(y,[["render",Ct]]);export{Tt as default};
