import{_ as x,I as p,f as y,g as w,c as a,o as l,b as e,i as u,t as r,e as m,F as j,j as D,h as k,v as h,l as C,G as M}from"./index-C-Ksv_Lv.js";const V={name:"DemandeDetails",props:{demande:{type:Object,required:!0}},setup(o,{emit:t}){const s=p(),n=y(!1),g=y(!1),c=y("");return w(()=>{o.demande&&o.demande.documents&&Object.assign(o.demande,o.demande.documents),console.log("DemandeDetails - Données reçues:",{demande:o.demande,documents:{cv:o.demande.cv,lettreMotivation:o.demande.lettreMotivation,carteIdentite:o.demande.carteIdentite,inscriptionUniversitaire:o.demande.inscriptionUniversitaire,recommandation:o.demande.recommandation,autresDocuments:o.demande.autresDocuments}})}),{formatDate:i=>i?new Date(i).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):"Non spécifiée",handleApprove:async()=>{try{n.value=!0;const i=await fetch(`/api/stage-request/${o.demande.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!i.ok){const b=await i.json();throw new Error(b.message||"Erreur lors de l'approbation de la demande")}const f=await i.json();s.success("La demande a été approuvée avec succès"),t("update"),t("close")}catch(i){console.error("Erreur:",i),s.error(i.message||"Une erreur est survenue lors de l'approbation de la demande")}finally{n.value=!1}},handleReject:async()=>{var i;if(!c.value){s.error("Veuillez indiquer le motif du refus");return}try{if(n.value=!0,(await M.post(`/stage-request/${o.demande.id}/reject`,{motif:c.value},{timeout:3e4,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).data)s.success("La demande a été refusée avec succès"),g.value=!1,t("close"),t("refresh");else throw new Error("Réponse invalide du serveur")}catch(f){console.error("Erreur lors du refus:",f),f.code==="ECONNABORTED"?s.error("Le serveur met trop de temps à répondre. Veuillez réessayer."):f.response?s.error(((i=f.response.data)==null?void 0:i.message)||"Une erreur est survenue lors du refus"):s.error("Une erreur est survenue lors du refus. Veuillez réessayer.")}finally{n.value=!1}},isLoading:n,showRejectModal:g,rejectMotif:c}}},_={class:"relative top-16 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white justify-between items-center"},L={class:"flex justify-between items-center mb-4"},R={class:"mb-6"},I={class:"grid grid-cols-3 gap-4"},A={class:"font-medium"},E={class:"font-medium"},T={class:"font-medium"},U={class:"font-medium"},z={class:"mb-6"},N={class:"grid grid-cols-3 gap-4"},B={class:"font-medium"},S={class:"font-medium"},q={class:"font-medium"},O={class:"font-medium"},F={class:"font-medium"},P={class:"font-medium"},G={class:"mb-6"},H={class:"grid grid-cols-1 gap-4"},J={key:0,class:"flex items-center justify-between p-4 border rounded-lg"},K=["href"],Q={key:1,class:"flex items-center justify-between p-4 border rounded-lg"},W=["href"],X={key:2,class:"flex items-center justify-between p-4 border rounded-lg"},Y=["href"],Z={key:3,class:"flex items-center justify-between p-4 border rounded-lg"},$=["href"],ee={key:4,class:"flex items-center justify-between p-4 border rounded-lg"},te=["href"],se={key:5,class:"flex items-center justify-between p-4 border rounded-lg"},ne={class:"space-y-2"},oe=["href"],de={class:"flex justify-end space-x-3 mt-6"},ie=["disabled"],re=["disabled"],ae={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},le={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},me={class:"flex justify-between items-center mb-4"},ue={class:"mb-4"},fe={class:"flex justify-end space-x-3"},ce=["disabled"];function ge(o,t,s,n,g,c){return l(),a("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:t[7]||(t[7]=C(d=>o.$emit("close"),["self"]))},[e("div",_,[e("div",L,[t[9]||(t[9]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Détails de la demande",-1)),e("button",{onClick:t[0]||(t[0]=d=>o.$emit("close")),class:"text-gray-400 hover:text-gray-500"},t[8]||(t[8]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",R,[t[14]||(t[14]=e("h4",{class:"text-lg font-semibold text-gray-800 mb-3"},"Informations du stagiaire",-1)),e("div",I,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-sm text-gray-600"},"Nom complet",-1)),e("p",A,r(s.demande.nom),1)]),e("div",null,[t[11]||(t[11]=e("p",{class:"text-sm text-gray-600"},"Email",-1)),e("p",E,r(s.demande.email),1)]),e("div",null,[t[12]||(t[12]=e("p",{class:"text-sm text-gray-600"},"Téléphone",-1)),e("p",T,r(s.demande.telephone),1)]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-600"},"Code de suivi",-1)),e("p",U,r(s.demande.code_suivi),1)])])]),e("div",z,[t[21]||(t[21]=e("h4",{class:"text-lg font-semibold text-gray-800 mb-3"},"Informations du stage",-1)),e("div",N,[e("div",null,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-600"},"Type de stage",-1)),e("p",B,r(s.demande.typeStage),1)]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-600"},"Département",-1)),e("p",S,r(s.demande.departement),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600"},"Université",-1)),e("p",q,r(s.demande.universite),1)]),e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm text-gray-600"},"Domaine d'études",-1)),e("p",O,r(s.demande.domaineEtude),1)]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-sm text-gray-600"},"Date de début",-1)),e("p",F,r(n.formatDate(s.demande.dateDebut)),1)]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-sm text-gray-600"},"Date de fin",-1)),e("p",P,r(n.formatDate(s.demande.dateFin)),1)])])]),e("div",G,[t[34]||(t[34]=e("h4",{class:"text-lg font-semibold text-gray-800 mb-3"},"Documents",-1)),e("div",H,[s.demande.cv?(l(),a("div",J,[t[23]||(t[23]=e("div",null,[e("p",{class:"font-medium"},"CV"),e("p",{class:"text-sm text-gray-500"},"Curriculum Vitae")],-1)),e("a",{href:s.demande.cv,target:"_blank",class:"btn-primary"},t[22]||(t[22]=[e("i",{class:"fas fa-eye mr-2"},null,-1),m(" Voir ")]),8,K)])):u("",!0),s.demande.lettreMotivation?(l(),a("div",Q,[t[25]||(t[25]=e("div",null,[e("p",{class:"font-medium"},"Lettre de motivation"),e("p",{class:"text-sm text-gray-500"},"Lettre de motivation")],-1)),e("a",{href:s.demande.lettreMotivation,target:"_blank",class:"btn-primary"},t[24]||(t[24]=[e("i",{class:"fas fa-eye mr-2"},null,-1),m(" Voir ")]),8,W)])):u("",!0),s.demande.carteIdentite?(l(),a("div",X,[t[27]||(t[27]=e("div",null,[e("p",{class:"font-medium"},"Carte d'identité"),e("p",{class:"text-sm text-gray-500"},"Pièce d'identité")],-1)),e("a",{href:s.demande.carteIdentite,target:"_blank",class:"btn-primary"},t[26]||(t[26]=[e("i",{class:"fas fa-eye mr-2"},null,-1),m(" Voir ")]),8,Y)])):u("",!0),s.demande.inscriptionUniversitaire?(l(),a("div",Z,[t[29]||(t[29]=e("div",null,[e("p",{class:"font-medium"},"Inscription universitaire"),e("p",{class:"text-sm text-gray-500"},"Certificat d'inscription")],-1)),e("a",{href:s.demande.inscriptionUniversitaire,target:"_blank",class:"btn-primary"},t[28]||(t[28]=[e("i",{class:"fas fa-eye mr-2"},null,-1),m(" Voir ")]),8,$)])):u("",!0),s.demande.recommandation?(l(),a("div",ee,[t[31]||(t[31]=e("div",null,[e("p",{class:"font-medium"},"Lettre de recommandation"),e("p",{class:"text-sm text-gray-500"},"Lettre de recommandation")],-1)),e("a",{href:s.demande.recommandation,target:"_blank",class:"btn-primary"},t[30]||(t[30]=[e("i",{class:"fas fa-eye mr-2"},null,-1),m(" Voir ")]),8,te)])):u("",!0),s.demande.autresDocuments&&s.demande.autresDocuments.length>0?(l(),a("div",se,[t[33]||(t[33]=e("div",null,[e("p",{class:"font-medium"},"Autres documents"),e("p",{class:"text-sm text-gray-500"},"Documents supplémentaires")],-1)),e("div",ne,[(l(!0),a(j,null,D(s.demande.autresDocuments,(d,v)=>(l(),a("a",{key:v,href:d,target:"_blank",class:"btn-primary block"},[t[32]||(t[32]=e("i",{class:"fas fa-eye mr-2"},null,-1)),m(" Voir document "+r(v+1),1)],8,oe))),128))])])):u("",!0)])]),e("div",de,[e("button",{onClick:t[1]||(t[1]=d=>n.showRejectModal=!0),disabled:n.isLoading,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50"},t[35]||(t[35]=[e("i",{class:"fas fa-times mr-2"},null,-1),m("Refuser ")]),8,ie),e("button",{onClick:t[2]||(t[2]=(...d)=>n.handleApprove&&n.handleApprove(...d)),disabled:n.isLoading,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50"},t[36]||(t[36]=[e("i",{class:"fas fa-check mr-2"},null,-1),m("Approuver ")]),8,re)])]),n.showRejectModal?(l(),a("div",ae,[e("div",le,[e("div",me,[t[38]||(t[38]=e("h3",{class:"text-lg font-bold text-gray-900"},"Motif du refus",-1)),e("button",{onClick:t[3]||(t[3]=d=>n.showRejectModal=!1),class:"text-gray-400 hover:text-gray-500"},t[37]||(t[37]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",ue,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Motif du refus ",-1)),k(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=d=>n.rejectMotif=d),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Veuillez indiquer le motif du refus..."},null,512),[[h,n.rejectMotif]])]),e("div",fe,[e("button",{onClick:t[5]||(t[5]=d=>n.showRejectModal=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," Annuler "),e("button",{onClick:t[6]||(t[6]=(...d)=>n.handleReject&&n.handleReject(...d)),disabled:n.isLoading,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50"}," Confirmer le refus ",8,ce)])])])):u("",!0)])}const be=x(V,[["render",ge],["__scopeId","data-v-6fb141f8"]]);export{be as D};
