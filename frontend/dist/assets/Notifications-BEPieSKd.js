import{_ as z,c as f,o as g,b as e,i as D,t as v,h as T,v as F,m as q,e as p,F as I,j as S,n as N,f as b,g as j,p as L,q as y,y as A}from"./index-C-Ksv_Lv.js";const O={name:"Notifications",setup(){const E=b(""),t=b(""),d=b([]),s=b(!1),i=b(null),_=b(1),a=10,h=async()=>{var r,o,n,c,u;try{if(s.value=!0,i.value=null,console.log("Chargement des notifications..."),!localStorage.getItem("token"))throw new Error("Vous devez être connecté pour voir vos notifications");const x=await A.getNotifications();if(console.log("Réponse brute des notifications:",JSON.stringify(x,null,2)),Array.isArray(x))d.value=x.map(m=>(console.log("Notification individuelle:",{id:m.id,dateCreation:m.dateCreation,createdAt:m.createdAt,date:m.date,read:m.read,raw:m}),{...m,dateCreation:m.createdAt||m.dateCreation||m.date,lu:!!m.read})),console.log("Notifications transformées:",d.value);else throw console.error("Format de réponse invalide:",x),new Error("Format de données invalide")}catch(l){console.error("Erreur détaillée:",{message:l.message,response:(r=l.response)==null?void 0:r.data,status:(o=l.response)==null?void 0:o.status}),((n=l.response)==null?void 0:n.status)===401?i.value="Session expirée. Veuillez vous reconnecter.":((c=l.response)==null?void 0:c.status)===403?i.value="Vous n'avez pas les droits pour accéder aux notifications.":(u=l.message)!=null&&u.includes("Network Error")?i.value="Impossible de se connecter au serveur. Veuillez vérifier votre connexion.":i.value=l.message||"Erreur lors du chargement des notifications"}finally{s.value=!1}};j(async()=>{console.log("Composant monté, chargement des notifications..."),await h()}),L(()=>localStorage.getItem("token"),async r=>{r&&(console.log("Token détecté, rechargement des notifications..."),await h())});const w=y(()=>{const r=E.value.toLowerCase();return d.value.filter(o=>{var u,l;const n=(((u=o.titre)==null?void 0:u.toLowerCase())||"").includes(r)||(((l=o.message)==null?void 0:l.toLowerCase())||"").includes(r),c=!t.value||o.type===t.value;return n&&c})}),M=y(()=>d.value.some(r=>!r.lu)),k=y(()=>Math.ceil(w.value.length/a)),C=y(()=>(_.value-1)*a),P=y(()=>Math.min(C.value+a,w.value.length)),V=y(()=>w.value.slice(C.value,P.value)),R=y(()=>{const r=[];if(k.value<=5)for(let n=1;n<=k.value;n++)r.push(n);else{let n=Math.max(1,_.value-Math.floor(2.5)),c=n+5-1;c>k.value&&(c=k.value,n=Math.max(1,c-5+1));for(let u=n;u<=c;u++)r.push(u)}return r});return{searchQuery:E,filterType:t,notifications:d,loading:s,error:i,currentPage:_,itemsPerPage:a,filteredNotifications:w,hasUnreadNotifications:M,totalPages:k,startIndex:C,endIndex:P,paginatedNotifications:V,displayedPages:R,markAllAsRead:async()=>{var r,o,n,c,u;try{if(s.value=!0,i.value=null,console.log("Marquage de toutes les notifications comme lues..."),!localStorage.getItem("token"))throw new Error("Vous devez être connecté pour marquer les notifications comme lues");await A.markAllAsRead(),console.log("Toutes les notifications ont été marquées comme lues"),d.value=d.value.map(x=>({...x,lu:!0}))}catch(l){console.error("Erreur détaillée:",{message:l.message,response:(r=l.response)==null?void 0:r.data,status:(o=l.response)==null?void 0:o.status}),((n=l.response)==null?void 0:n.status)===401?i.value="Session expirée. Veuillez vous reconnecter.":((c=l.response)==null?void 0:c.status)===403?i.value="Vous n'avez pas les droits pour modifier les notifications.":(u=l.message)!=null&&u.includes("Network Error")?i.value="Impossible de se connecter au serveur. Veuillez vérifier votre connexion.":i.value=l.message||"Erreur lors du marquage des notifications comme lues"}finally{s.value=!1}},markAsRead:async r=>{try{s.value=!0,i.value=null,await A.markAsRead(r.id);const o=d.value.findIndex(n=>n.id===r.id);o!==-1&&(d.value[o]={...d.value[o],lu:!0})}catch(o){console.error("Erreur lors du marquage de la notification comme lue:",o),i.value="Erreur lors du marquage de la notification comme lue"}finally{s.value=!1}},deleteNotification:async r=>{try{s.value=!0,i.value=null,await A.deleteNotification(r.id),d.value=d.value.filter(o=>o.id!==r.id)}catch(o){console.error("Erreur lors de la suppression de la notification:",o),i.value="Erreur lors de la suppression de la notification"}finally{s.value=!1}},formatDate:r=>{if(console.log("Tentative de formatage de la date:",r),!r)return console.log("Date manquante"),"Date inconnue";try{const o=new Date(r);if(isNaN(o.getTime()))return console.error("Date invalide:",r),"Date invalide";const n=o.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return console.log("Date formatée avec succès:",{original:r,formatted:n}),n}catch(o){return console.error("Erreur lors du formatage de la date:",o,"Date originale:",r),"Date invalide"}},getNotificationIcon:r=>{switch(r){case"DEMANDE":return"fas fa-file-alt";case"AFFECTATION":return"fas fa-user-check";case"SYSTEME":return"fas fa-cog";default:return"fas fa-bell"}},getNotificationIconClass:r=>{switch(r){case"DEMANDE":return"bg-blue-500";case"AFFECTATION":return"bg-green-500";case"SYSTEME":return"bg-purple-500";default:return"bg-gray-500"}}}}},B={class:"p-4"},Q={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},U={key:1,class:"flex justify-center items-center py-4"},Y={key:2,class:"bg-white rounded-lg shadow"},J={class:"p-4 border-b"},G={class:"flex justify-between items-center"},H={class:"flex items-center space-x-4"},K={class:"flex items-center space-x-2"},W=["disabled"],X={class:"divide-y divide-gray-200"},Z={class:"flex items-start justify-between"},$={class:"flex items-start space-x-3"},ee={class:"flex-shrink-0"},te={class:"flex-1"},se={class:"text-sm font-medium text-gray-900"},re={class:"text-sm text-gray-500 mt-1"},ae={class:"mt-2 flex items-center text-xs text-gray-500"},oe={key:0,class:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full"},ne={class:"flex items-center space-x-2"},le=["onClick"],ie=["onClick"],de={class:"px-4 py-3 border-t border-gray-200 sm:px-6"},ce={class:"flex items-center justify-between"},ue={class:"flex-1 flex justify-between sm:hidden"},me=["disabled"],fe=["disabled"],ge={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},ve={class:"text-sm text-gray-700"},ye={class:"font-medium"},xe={class:"font-medium"},pe={class:"font-medium"},be={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},he=["disabled"],ke=["onClick"],_e=["disabled"];function we(E,t,d,s,i,_){return g(),f("div",B,[t[19]||(t[19]=e("h1",{class:"text-2xl text-slate-800 font-bold mb-6"},"Mes Notifications",-1)),s.error?(g(),f("div",Q,v(s.error),1)):D("",!0),s.loading?(g(),f("div",U,t[7]||(t[7]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):(g(),f("div",Y,[e("div",J,[e("div",G,[e("div",H,[T(e("input",{type:"text",placeholder:"Rechercher dans les notifications...",class:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary","onUpdate:modelValue":t[0]||(t[0]=a=>s.searchQuery=a)},null,512),[[F,s.searchQuery]]),T(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.filterType=a),class:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"},t[8]||(t[8]=[e("option",{value:""},"Tous les types",-1),e("option",{value:"DEMANDE"},"Demandes",-1),e("option",{value:"AFFECTATION"},"Affectations",-1),e("option",{value:"SYSTEME"},"Système",-1)]),512),[[q,s.filterType]])]),e("div",K,[e("button",{onClick:t[2]||(t[2]=(...a)=>s.markAllAsRead&&s.markAllAsRead(...a)),class:"bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200",disabled:!s.hasUnreadNotifications},t[9]||(t[9]=[e("i",{class:"fas fa-check-double mr-2"},null,-1),p("Tout marquer comme lu ")]),8,W)])])]),e("div",X,[(g(!0),f(I,null,S(s.paginatedNotifications,a=>(g(),f("div",{key:a.id,class:N(["p-4 hover:bg-gray-50 transition-colors duration-150",{"bg-blue-50":!a.lu}])},[e("div",Z,[e("div",$,[e("div",ee,[e("div",{class:N(["w-10 h-10 rounded-full flex items-center justify-center",s.getNotificationIconClass(a.type)])},[e("i",{class:N([s.getNotificationIcon(a.type),"text-white"])},null,2)],2)]),e("div",te,[e("p",se,v(a.titre),1),e("p",re,v(a.message),1),e("div",ae,[t[10]||(t[10]=e("i",{class:"far fa-clock mr-1"},null,-1)),p(" "+v(s.formatDate(a.dateCreation))+" ",1),a.lu?D("",!0):(g(),f("span",oe," Non lu "))])])]),e("div",ne,[a.lu?D("",!0):(g(),f("button",{key:0,onClick:h=>s.markAsRead(a),class:"text-gray-400 hover:text-gray-600",title:"Marquer comme lu"},t[11]||(t[11]=[e("i",{class:"fas fa-check"},null,-1)]),8,le)),e("button",{onClick:h=>s.deleteNotification(a),class:"text-gray-400 hover:text-red-600",title:"Supprimer"},t[12]||(t[12]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ie)])])],2))),128))]),e("div",de,[e("div",ce,[e("div",ue,[e("button",{onClick:t[3]||(t[3]=a=>s.currentPage--),disabled:s.currentPage===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Précédent ",8,me),e("button",{onClick:t[4]||(t[4]=a=>s.currentPage++),disabled:s.currentPage>=s.totalPages,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Suivant ",8,fe)]),e("div",ge,[e("div",null,[e("p",ve,[t[13]||(t[13]=p(" Affichage de ")),e("span",ye,v(s.startIndex+1),1),t[14]||(t[14]=p(" à ")),e("span",xe,v(s.endIndex),1),t[15]||(t[15]=p(" sur ")),e("span",pe,v(s.filteredNotifications.length),1),t[16]||(t[16]=p(" notifications "))])]),e("div",null,[e("nav",be,[e("button",{onClick:t[5]||(t[5]=a=>s.currentPage--),disabled:s.currentPage===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},t[17]||(t[17]=[e("span",{class:"sr-only"},"Précédent",-1),e("i",{class:"fas fa-chevron-left"},null,-1)]),8,he),(g(!0),f(I,null,S(s.displayedPages,a=>(g(),f("button",{key:a,onClick:h=>s.currentPage=a,class:N([s.currentPage===a?"z-10 bg-primary-50 border-primary-500 text-primary-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},v(a),11,ke))),128)),e("button",{onClick:t[6]||(t[6]=a=>s.currentPage++),disabled:s.currentPage>=s.totalPages,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},t[18]||(t[18]=[e("span",{class:"sr-only"},"Suivant",-1),e("i",{class:"fas fa-chevron-right"},null,-1)]),8,_e)])])])])])]))])}const Ie=z(O,[["render",we],["__scopeId","data-v-fdde4f59"]]);export{Ie as default};
