import{_ as T,c as u,o as p,b as e,F as x,j as _,t as g,n as f,e as B,k as D,I as F,f as d,g as N,Q as R,Y as h}from"./index-C-Ksv_Lv.js";import{C as b}from"./auto-Cz6uSJnr.js";const j={name:"Statistiques",setup(){const i=F(),r=d(null),v=d(null),c=d(null),l=d({monthly:null,type:null,education:null}),y=d([{title:"Total des stages",value:"0",trend:0,icon:"fas fa-users",iconColor:"bg-blue-100 text-blue-600"},{title:"Stages en cours",value:"0",trend:0,icon:"fas fa-clock",iconColor:"bg-green-100 text-green-600"},{title:"Taux de completion",value:"0%",trend:0,icon:"fas fa-check-circle",iconColor:"bg-yellow-100 text-yellow-600"},{title:"Taux de satisfaction",value:"0/5",trend:0,icon:"fas fa-star",iconColor:"bg-purple-100 text-purple-600"}]),o=d([]),m=t=>{l.value[t]&&(l.value[t].destroy(),l.value[t]=null)},w=async()=>{var t,n;try{const a=(await h.getGeneralStats()).data;y.value=[{title:"Total des stages",value:((t=a.total)==null?void 0:t.toString())||"0",trend:a.trend||0,icon:"fas fa-users",iconColor:"bg-blue-100 text-blue-600"},{title:"Stages en cours",value:((n=a.enCours)==null?void 0:n.toString())||"0",trend:a.trendEnCours||0,icon:"fas fa-clock",iconColor:"bg-green-100 text-green-600"},{title:"Taux de completion",value:`${a.tauxCompletion||0}%`,trend:a.trendCompletion||0,icon:"fas fa-check-circle",iconColor:"bg-yellow-100 text-yellow-600"},{title:"Taux de satisfaction",value:`${a.tauxSatisfaction||0}/5`,trend:a.trendSatisfaction||0,icon:"fas fa-star",iconColor:"bg-purple-100 text-purple-600"}]}catch(s){console.error("Erreur lors de la récupération des statistiques générales:",s),i.error("Erreur lors du chargement des statistiques générales")}},C=async()=>{try{const n=(await h.getStructuresStats()).data||[],s=n.reduce((a,q)=>a+(q.count||0),0);o.value=n.map(a=>({name:a.nom||"Structure inconnue",count:a.count||0,percentage:s>0?Math.round((a.count||0)/s*100):0}))}catch(t){console.error("Erreur lors de la récupération des statistiques des structures:",t),i.error("Erreur lors du chargement des statistiques des structures")}},S=async()=>{try{m("monthly");const n=(await h.getDemandesEvolution()).data||[];l.value.monthly=new b(r.value,{type:"line",data:{labels:n.map(s=>new Date(s.month).toLocaleDateString("fr-FR",{month:"short"})),datasets:[{label:"Nouveaux stages",data:n.map(s=>s.count||0),borderColor:"#3B82F6",tension:.4}]},options:{responsive:!0,plugins:{legend:{position:"top"}}}})}catch(t){console.error("Erreur lors de l'initialisation du graphique mensuel:",t),i.error("Erreur lors du chargement des données mensuelles")}},E=async()=>{try{m("type");const n=(await h.getTypeStats()).data||[];l.value.type=new b(v.value,{type:"doughnut",data:{labels:n.map(s=>s.type||"Type inconnu"),datasets:[{data:n.map(s=>s.count||0),backgroundColor:["#3B82F6","#10B981","#8B5CF6"]}]},options:{responsive:!0,plugins:{legend:{position:"right"}}}})}catch(t){console.error("Erreur lors de l'initialisation du graphique des types:",t),i.error("Erreur lors du chargement des données des types")}},k=async()=>{try{m("education");const n=(await h.getEducationStats()).data||[];l.value.education=new b(c.value,{type:"bar",data:{labels:n.map(s=>s.niveau||"Niveau inconnu"),datasets:[{label:"Nombre de stagiaires",data:n.map(s=>s.count||0),backgroundColor:"#60A5FA"}]},options:{responsive:!0,plugins:{legend:{display:!1}}}})}catch(t){console.error("Erreur lors de l'initialisation du graphique des niveaux:",t),i.error("Erreur lors du chargement des données des niveaux")}};return N(async()=>{await Promise.all([w(),C(),S(),E(),k()])}),R(()=>{Object.keys(l.value).forEach(t=>m(t))}),{generalStats:y,structureStats:o,monthlyChart:r,typeChart:v,educationChart:c}}},M={class:"p-6"},$={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},z={class:"flex justify-between items-center"},A={class:"text-sm text-gray-600"},G={class:"text-3xl font-bold mt-2"},L={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},V={class:"bg-white p-6 rounded-lg shadow-sm"},I={ref:"monthlyChart",height:"300"},O={class:"bg-white p-6 rounded-lg shadow-sm"},P={ref:"typeChart",height:"300"},Q={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},U={class:"bg-white p-6 rounded-lg shadow-sm"},Y={class:"space-y-4"},H={class:"flex-1"},J={class:"flex justify-between mb-1"},W={class:"text-sm font-medium"},X={class:"text-sm text-gray-600"},Z={class:"w-full bg-gray-200 rounded-full h-2"},K={class:"bg-white p-6 rounded-lg shadow-sm"},ee={ref:"educationChart",height:"300"};function te(i,r,v,c,l,y){return p(),u("div",M,[r[4]||(r[4]=e("h1",{class:"text-2xl text-slate-800 font-bold mb-6"},"Statistiques Détaillées",-1)),e("div",$,[(p(!0),u(x,null,_(c.generalStats,o=>(p(),u("div",{key:o.title,class:"bg-white p-6 rounded-lg shadow-sm"},[e("div",z,[e("div",null,[e("p",A,g(o.title),1),e("h2",G,g(o.value),1),e("p",{class:f(["text-sm mt-2",o.trend>=0?"text-green-600":"text-red-600"])},[e("i",{class:f(o.trend>=0?"fas fa-arrow-up":"fas fa-arrow-down")},null,2),B(" "+g(Math.abs(o.trend))+"% depuis le mois dernier ",1)],2)]),e("div",{class:f([o.iconColor,"p-4 rounded-full"])},[e("i",{class:f([o.icon,"text-2xl"])},null,2)],2)])]))),128))]),e("div",L,[e("div",V,[r[0]||(r[0]=e("h3",{class:"text-lg font-semibold mb-4"},"Évolution mensuelle des stages",-1)),e("canvas",I,null,512)]),e("div",O,[r[1]||(r[1]=e("h3",{class:"text-lg font-semibold mb-4"},"Répartition par type de stage",-1)),e("canvas",P,null,512)])]),e("div",Q,[e("div",U,[r[2]||(r[2]=e("h3",{class:"text-lg font-semibold mb-4"},"Répartition par structure",-1)),e("div",Y,[(p(!0),u(x,null,_(c.structureStats,o=>(p(),u("div",{key:o.name,class:"flex items-center"},[e("div",H,[e("div",J,[e("span",W,g(o.name),1),e("span",X,g(o.count)+" stagiaires",1)]),e("div",Z,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:D({width:o.percentage+"%"})},null,4)])])]))),128))])]),e("div",K,[r[3]||(r[3]=e("h3",{class:"text-lg font-semibold mb-4"},"Répartition par niveau d'études",-1)),e("canvas",ee,null,512)])])])}const ae=T(j,[["render",te]]);export{ae as default};
